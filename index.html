<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>꼬비아빠 놀이터</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/decimal.js/10.4.3/decimal.min.js"></script>
<style>
  /* 바디 레벨 플로팅 툴팁 */
  .floating-tip{
    position: fixed; z-index: 9999; max-width: 360px;
    background:#0b1320; color:#cfe1ff; border:1px solid #2b3a55;
    border-radius:10px; padding:8px 10px; font-size:12px; line-height:1.35;
    box-shadow:0 8px 24px rgba(0,0,0,.35);
    pointer-events:none; white-space:normal; word-break:keep-all;
    opacity:0; transform: translateY(4px);
    transition: opacity .12s ease, transform .12s ease;
  }
  .floating-tip.show{ opacity:1; transform: translateY(0); }
  .floating-tip::after{
    content:""; position:absolute; width:10px; height:10px; left:50%;
    transform: translateX(-50%) rotate(45deg);
    background:#0b1320; border-left:1px solid #2b3a55; border-top:1px solid #2b3a55;
  }
  .floating-tip[data-pos="top"]::after{ bottom:-5px; }
  .floating-tip[data-pos="bottom"]::after{ top:-5px; transform: translateX(-50%) rotate(225deg); }

  :root{
    --bg:#0f1115; --panel:#161a22; --muted:#8a9099; --accent:#6aa0ff;
    --ok:#35c759; --warn:#ffb300; --bad:#ff5171; --chip:#232a36;
    --ring:#1f2530; --text:#e8ecf3; --highlight:#fff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    background:linear-gradient(180deg,#0f1115 0%,#0c0f14 100%); color:var(--text);
  }
  header{
    display:flex; align-items:center; justify-content:space-between;
    padding:16px 20px; border-bottom:1px solid #232a36; background:rgba(0,0,0,.2);
    position:sticky; top:0; z-index:10;
  }
  .brand{font-weight:700; letter-spacing:.3px}
  .ver{color:var(--muted); font-size:12px; display:flex; align-items:center; gap:10px}
  .grid{ max-width:1100px; margin:20px auto; padding:0 16px; display:grid; gap:16px; grid-template-columns: 1fr 1fr; }
  @media (max-width: 980px){ .grid{grid-template-columns:1fr} }
  .card{background:var(--panel); border:1px solid #232a36; border-radius:14px; padding:16px; box-shadow:0 6px 24px rgba(0,0,0,.25);}
  .card h3{margin:4px 0 12px 0; font-size:16px}
  .row{display:flex; gap:8px; flex-wrap:wrap}
  .col{flex:1 1 0}
  label{display:block; font-size:12px; color:var(--muted); margin:6px 0 4px 2px}
  input[type="number"], input[type="text"]{
    width:100%; padding:10px 12px; border-radius:10px; border:1px solid #2a3040;
    background:#0e1218; color:var(--text); outline:none;
  }
  input[readonly]{opacity:.7; cursor:not-allowed}
  input[type="number"]::-webkit-outer-spin-button,
  input[type="number"]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0; }
  .btn{ padding:10px 14px; border-radius:10px; border:1px solid #334055; cursor:pointer; background:#142033; color:#cfe1ff; font-weight:600; }
  .btn:hover{filter:brightness(1.1)}
  .btn.primary{ background:linear-gradient(180deg,#2b71ff,#1d56cc); border-color:transparent; color:white;}
  .btn.ghost{ background:transparent;}
  .btn-sm{padding:6px 10px; font-size:12px; border-radius:8px}
  .muted{color:var(--muted)}
  .chips{display:flex; gap:8px; flex-wrap:wrap}
  .chip{ background:var(--chip); color:#cfd6e3; border:1px solid #2b3242; border-radius:999px; padding:6px 10px; font-size:12px; cursor:pointer; }
  .chip.on{outline:2px solid var(--accent)}
  .kbd{display:inline-block; border:1px solid #404a5e; border-bottom-width:3px; padding:2px 6px; border-radius:6px; background:#0e131a; font-weight:700}
  .chooser{display:grid; grid-template-columns: 1fr; gap:8px}
  .list{ max-height:260px; overflow:auto; border:1px solid #2a3040; border-radius:10px; padding:6px; background:#0d1117; }
  .item{padding:8px 10px; border-radius:8px; cursor:pointer; display:flex; justify-content:space-between; align-items:center; transition: background .12s ease, outline-color .12s ease; }
  .item:hover{background:#19202b}
  .item.selected{ background:#1b2535; outline:2px solid #30518d; }
  .tags{display:flex; gap:6px; align-items:center}
  .tag{font-size:11px;border:1px solid #2b3242;border-radius:999px;padding:2px 8px}
  .tag.ok{border-color:#275a34; background:#102214; color:#35c759}
  .tag.warn{border-color:#7a5b0e; background:#241a05; color:#ffb300}
  .tag.rank8{border-color:#2b4a82; background:#0d1a33; color:#88b5ff}
  .kpis{display:grid; grid-template-columns: repeat(3, 1fr); gap:12px}
  @media (max-width: 720px){ .kpis{grid-template-columns: 1fr} }
  .kpi{ display:flex; gap:14px; align-items:center; border:1px solid #2a3040; border-radius:14px; padding:14px; background:radial-gradient(120px 120px at 20% -10%, #11224444, transparent); }
  .ring{width:60px; height:60px; border-radius:50%; background:conic-gradient(var(--accent) 0deg, var(--accent) var(--p,0deg), var(--ring) var(--p,0deg)); display:grid; place-items:center}
  .ring::after{content:""; width:48px; height:48px; background:#0c1016; border-radius:50%; display:block}
  .kpi strong{font-size:20px; color:var(--highlight)}
  .kpi small{display:block; color:var(--muted)}
  .table{width:100%; border-collapse:collapse; font-size:13px}
  .table th,.table td{border-bottom:1px solid #262d3a; padding:8px 6px; text-align:right}
  .table th:first-child,.table td:first-child{text-align:left}
  .badge{display:inline-block; min-width:34px; text-align:center; padding:2px 6px; border-radius:6px; background:#223; border:1px solid #356}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
  .footer{max-width:1100px; margin:8px auto 30px; padding:0 16px; color:var(--muted); font-size:12px}
  .imgbox{width:100%; aspect-ratio: 16/9; border:1px dashed #334055; border-radius:12px; display:grid; place-items:center; background:#0d1117; overflow:hidden;}
  .imgbox img{width:100%; height:100%; object-fit:cover; display:block}
  .stepper{display:flex; gap:6px; margin-top:6px}
</style>
</head>
<body>
<header>
  <div class="brand">꼬비아빠 놀이터</div>
  <div class="ver">
    <span>25.10.03 · <span class="muted">꼬비아빠</span></span>
    <button class="btn ghost" id="btnAdmin">★</button>
  </div>
</header>

<div class="grid">
  <!-- 좌: 펫 선택 -->
  <section class="card">
    <h3>① 펫 선택</h3>
    <div class="row">
      <div class="col chooser">
        <label>초성 키패드</label>
        <div id="chosung" class="chips"></div>

        <div class="row" style="margin-top:6px; align-items:center">
          <span class="muted" style="min-width:78px">선택한 초성</span>
          <div id="chosungTokens" class="chips" style="min-height:28px"></div>
        </div>

        <div class="row" style="margin-top:8px">
          <div class="col">
            <input type="text" id="petSearch" placeholder="이름으로 검색 (예: 카르곤, 반기노)" />
          </div>
          <button class="btn" id="btnClear">지우기</button>
        </div>
        <div class="list" id="petList"></div>
      </div>
    </div>
    <p class="muted" style="margin-top:8px">팁: 초성만 두세 번 눌러도 후보가 빠르게 걸러집니다. (예: 반기노 = <span class="kbd">ㅂ</span>→<span class="kbd">ㄱ</span>)</p>
  </section>

  <!-- 우: 표기 S0 / Sg + 관측 입력 -->
  <section class="card">
    <h3>② 표기치 & 관측치 입력</h3>

    <div class="row">
      <div class="col">
        <label>표기 초기치 S0 (체/공/방/순)</label>
        <div class="row">
          <div class="col"><input type="number" id="s0_hp"  step="0.01" placeholder="—" readonly /></div>
          <div class="col"><input type="number" id="s0_atk" step="0.01" placeholder="—" readonly /></div>
          <div class="col"><input type="number" id="s0_def" step="0.01" placeholder="—" readonly /></div>
          <div class="col"><input type="number" id="s0_agi" step="0.01" placeholder="—" readonly /></div>
        </div>

        <label style="margin-top:10px">표기 성장치 Sg (체/공/방/순)</label>
        <div class="row">
          <div class="col"><input type="number" id="sg_hp"  step="0.01" placeholder="—" readonly /></div>
          <div class="col"><input type="number" id="sg_atk" step="0.01" placeholder="—" readonly /></div>
          <div class="col"><input type="number" id="sg_def" step="0.01" placeholder="—" readonly /></div>
          <div class="col"><input type="number" id="sg_agi" step="0.01" placeholder="—" readonly /></div>
        </div>
      </div>
    </div>

    <hr style="border:none;border-top:1px solid #2a3040; margin:14px 0" />

    <div class="row">
      <div class="col">
        <label>내 펫 레벨1 관측 표기치 (정수) — 체/공/방/순</label>
        <div class="row">
          <div class="col">
            <input type="number" id="obs_hp"  step="1" />
            <div class="stepper">
              <button class="btn btn-sm" data-target="obs_hp" data-delta="-1">-1</button>
              <button class="btn btn-sm" data-target="obs_hp" data-delta="1">+1</button>
            </div>
          </div>
          <div class="col">
            <input type="number" id="obs_atk" step="1" />
            <div class="stepper">
              <button class="btn btn-sm" data-target="obs_atk" data-delta="-1">-1</button>
              <button class="btn btn-sm" data-target="obs_atk" data-delta="1">+1</button>
            </div>
          </div>
          <div class="col">
            <input type="number" id="obs_def" step="1" />
            <div class="stepper">
              <button class="btn btn-sm" data-target="obs_def" data-delta="-1">-1</button>
              <button class="btn btn-sm" data-target="obs_def" data-delta="1">+1</button>
            </div>
          </div>
          <div class="col">
            <input type="number" id="obs_agi" step="1" />
            <div class="stepper">
              <button class="btn btn-sm" data-target="obs_agi" data-delta="-1">-1</button>
              <button class="btn btn-sm" data-target="obs_agi" data-delta="1">+1</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row" style="margin-top:12px">
      <button class="btn primary" id="btnCalc">계산</button>
      <button class="btn ghost" id="btnReset">리셋</button>
      <span class="muted" style="margin-left:auto">스크롤 업/다운으로 수치 조정 가능</span>
    </div>
  </section>

  <!-- 좌하단: KPI 강조 -->
  <section class="card" id="resultCard">
    <h3>③ 결과</h3>
    <div class="kpis">
      <div class="kpi">
        <div class="ring" id="ringSuccess" style="--p:0deg"></div>
        <div>
          <strong id="kpiSuccess">—%</strong>
          <small>환각(8등급) 확률</small>
        </div>
      </div>
      <div class="kpi">
        <div class="ring" id="ringAppear" style="--p:0deg"></div>
        <div>
          <strong id="kpiAppear">—%</strong>
          <small>출현 확률</small>
        </div>
      </div>
      <div class="kpi">
        <div class="ring" style="--p:360deg; background:conic-gradient(#888 360deg, #888 360deg, var(--ring) 360deg)"></div>
        <div>
          <strong id="kpiTries">—</strong>
          <small>성공 기대값(시도)</small>
        </div>
      </div>
    </div>

    <div style="margin-top:14px">
      <div class="row">
        <div class="col"><span class="muted">총 경우의 수:</span> <span class="badge" id="totMatches">—</span></div>
        <div class="col"><span class="muted">환각 매칭:</span> <span class="badge" id="rank8Matches">—</span></div>
        <div class="col"><span class="muted">전수(고정):</span> <span class="badge">178,750</span></div>
      </div>
    </div>

    <details style="margin-top:12px">
      <summary>등급 분포 자세히 보기</summary>
      <div id="dist"></div>
    </details>
  </section>

  <!-- 우하단: 이미지 공간 -->
  <section class="card">
    <h3>본 계산기는 오픈 소스로 만들어졌습니다.</h3>
    <div class="imgbox">
      <img id="dinoImg" src="https://raw.githubusercontent.com/Kokudas/Kokudas.github.io/main/67269_179791_1130-Photoroom.png" alt="StoneAge Dino" loading="lazy" decoding="async"/>
    </div>
    <p class="muted" style="margin-top:8px">꼬비아빠의 놀이터 </p>
  </section>
</div>

<div class="footer">
  <p>· “환각(8등급)”은 베이스 합계가 <b>+8</b>인 경우만 집계합니다. (베이스 각 항목 범위 −2..+2, 보너스 총합 10 분배)</p>
  <p>· 이 계산기는 해피 서버 페트 및 짜얄 계산기 데이터 계수 기반으로 제작되었으며, 이에 따라 결과값은 단순 재미로만 봐 주시길 바랍니다.</p>
</div>

</style>
    <script>
        var pet = [
            {"name":"우리","initnum":10,"hp":20,"atk":12,"def":15,"agi":25},
            {"name":"두리","initnum":20,"hp":22,"atk":23,"def":11,"agi":23},
            {"name":"얼룩우리","initnum":15,"hp":22,"atk":17,"def":19,"agi":17},
            {"name":"불그리","initnum":10,"hp":25,"atk":23,"def":19,"agi":33},
            {"name":"실버우리","initnum":20,"hp":22,"atk":22,"def":24,"agi":27},
            {"name":"환생얼룩우리","initnum":25,"hp":30,"atk":24,"def":27,"agi":24},
            {"name":"복우리","initnum":21,"hp":21,"atk":19,"def":19,"agi":28},
            {"name":"푸우리","initnum":21,"hp":25,"atk":27,"def":11,"agi":25},
            {"name":"녹우리","initnum":20,"hp":26,"atk":32,"def":21,"agi":24},
            {"name":"우리스타","initnum":18,"hp":22,"atk":14,"def":18,"agi":28},
            {"name":"핑우리","initnum":21,"hp":25,"atk":34,"def":19,"agi":25},
            
            {"name":"부비","initnum":15,"hp":42,"atk":20,"def":16,"agi":12},
            {"name":"골드부비","initnum":25,"hp":31,"atk":20,"def":32,"agi":12},
            {"name":"부이","initnum":22,"hp":44,"atk":21,"def":16,"agi":13},
            {"name":"부이비","initnum":16,"hp":32,"atk":26,"def":15,"agi":18},
            {"name":"얼룩부이비","initnum":23,"hp":30,"atk":28,"def":14,"agi":20},
            {"name":"푸비","initnum":24,"hp":31,"atk":34,"def":24,"agi":18},
            {"name":"푸이","initnum":24,"hp":34,"atk":36,"def":21,"agi":18},
            {"name":"깡우비","initnum":18,"hp":29,"atk":30,"def":15,"agi":20},
            
            {"name":"꼬미","initnum":22,"hp":22,"atk":28,"def":15,"agi":27},
            {"name":"꼬비","initnum":22,"hp":22,"atk":27,"def":17,"agi":27},
            {"name":"꼬비오","initnum":22,"hp":21,"atk":27,"def":15,"agi":29},
            {"name":"꼬꼬비","initnum":22,"hp":21,"atk":28,"def":15,"agi":28},
            {"name":"꼬꼬미","initnum":22,"hp":25,"atk":29,"def":17,"agi":28},
            {"name":"꼬이미","initnum":22,"hp":21,"atk":26,"def":18,"agi":22},
            {"name":"돌꼬비","initnum":22,"hp":25,"atk":31,"def":17,"agi":25},
            {"name":"푸미","initnum":22,"hp":27,"atk":31,"def":16,"agi":25},
            
            {"name":"푸푸","initnum":13,"hp":18,"atk":20,"def":8,"agi":33},
            {"name":"우푸","initnum":15,"hp":18,"atk":22,"def":7,"agi":32},
            {"name":"투투","initnum":17,"hp":23,"atk":22,"def":8,"agi":26},
            {"name":"오투투","initnum":20,"hp":20,"atk":19,"def":15,"agi":30},
            {"name":"포포","initnum":16,"hp":20,"atk":24,"def":8,"agi":36},
            {"name":"푸투투","initnum":14,"hp":29,"atk":23,"def":14,"agi":31},
            {"name":"노투투","initnum":15,"hp":22,"atk":24,"def":13,"agi":39},
            {"name":"푸투","initnum":15,"hp":22,"atk":24,"def":9,"agi":33},
            {"name":"마아란","initnum":26,"hp":23,"atk":29,"def":9,"agi":38},
            
            {"name":"베론","initnum":23,"hp":42,"atk":18,"def":37,"agi":18},
            {"name":"베로로크","initnum":19,"hp":39,"atk":19,"def":37,"agi":17},
            {"name":"베로보크","initnum":23,"hp":38,"atk":18,"def":36,"agi":14},
            {"name":"베로포리","initnum":22,"hp":34,"atk":25,"def":35,"agi":15},
            {"name":"베노노크","initnum":22,"hp":36,"atk":27,"def":32,"agi":22},
            {"name":"베톤","initnum":22,"hp":40,"atk":24,"def":42,"agi":14},
            {"name":"베노투리","initnum":22,"hp":37,"atk":25,"def":41,"agi":17},
            {"name":"베로바드","initnum":22,"hp":36,"atk":33,"def":31,"agi":19},
            {"name":"베노미","initnum":27,"hp":37,"atk":36,"def":35,"agi":6},
            
            {"name":"노북이","initnum":14,"hp":22,"atk":18,"def":34,"agi":6},
            {"name":"북이","initnum":14,"hp":22,"atk":19,"def":35,"agi":5},
            {"name":"깡북이","initnum":12,"hp":21,"atk":24,"def":33,"agi":5},
            {"name":"돌북이","initnum":20,"hp":23,"atk":19,"def":41,"agi":4},
            {"name":"물북이","initnum":14,"hp":24,"atk":20,"def":35,"agi":9},
            {"name":"킹북이","initnum":21,"hp":23,"atk":19,"def":42,"agi":4},
            {"name":"철북이","initnum":19,"hp":22,"atk":30,"def":34,"agi":6},
            {"name":"자라북","initnum":20,"hp":28,"atk":26,"def":42,"agi":3},
            {"name":"메카북이","initnum":24,"hp":42,"atk":34,"def":38,"agi":6},
            
            {"name":"아고아","initnum":20,"hp":25,"atk":39,"def":24,"agi":19},
            {"name":"네고스","initnum":20,"hp":26,"atk":37,"def":26,"agi":18},
            {"name":"타로곤","initnum":20,"hp":25,"atk":37,"def":26,"agi":18},
            {"name":"다고스","initnum":20,"hp":27,"atk":38,"def":23,"agi":18},
            {"name":"보크곤","initnum":20,"hp":23,"atk":38,"def":22,"agi":24},
            {"name":"골드곤","initnum":20,"hp":25,"atk":33,"def":21,"agi":19},
            {"name":"기고아","initnum":20,"hp":23,"atk":34,"def":24,"agi":16},
            {"name":"타로아","initnum":20,"hp":25,"atk":36,"def":21,"agi":17},
            {"name":"뉴로아","initnum":29,"hp":35,"atk":37,"def":27,"agi":20},
            
            {"name":"라고고","initnum":23,"hp":22,"atk":28,"def":17,"agi":26},
            {"name":"후바바","initnum":24,"hp":22,"atk":25,"def":18,"agi":28},
            {"name":"토루루","initnum":21,"hp":23,"atk":25,"def":23,"agi":27},
            {"name":"루니","initnum":22,"hp":24,"atk":23,"def":25,"agi":22},
            {"name":"푸고고","initnum":24,"hp":26,"atk":28,"def":14,"agi":26},
            {"name":"라루루","initnum":21,"hp":24,"atk":29,"def":15,"agi":29},
            {"name":"기바바","initnum":23,"hp":26,"atk":29,"def":24,"agi":20},
            {"name":"주니","initnum":19,"hp":27,"atk":33,"def":19,"agi":35},
            {"name":"쿠로로","initnum":23,"hp":30,"atk":27,"def":17,"agi":29},
            {"name":"푸루바","initnum":27,"hp":31,"atk":38,"def":11,"agi":33},
                                    
            {"name":"카타르카스","initnum":22,"hp":25,"atk":24,"def":40,"agi":5},
            {"name":"쿠카스","initnum":22,"hp":27,"atk":21,"def":39,"agi":6},
            {"name":"코로카스","initnum":17,"hp":29,"atk":26,"def":37,"agi":5},
            {"name":"로기안","initnum":23,"hp":25,"atk":22,"def":39,"agi":7},
            {"name":"램가스","initnum":20,"hp":32,"atk":25,"def":52,"agi":5},
            {"name":"아이카스","initnum":22,"hp":31,"atk":23,"def":40,"agi":5},
            {"name":"쿠타스","initnum":22,"hp":31,"atk":25,"def":33,"agi":5},
            {"name":"카르기안","initnum":20,"hp":25,"atk":22,"def":36,"agi":10},
            {"name":"엘로카스","initnum":24,"hp":35,"atk":28,"def":46,"agi":6,"rank":435},
            
            {"name":"리비노","initnum":25,"hp":27,"atk":37,"def":19,"agi":17},
            {"name":"얀기로","initnum":27,"hp":27,"atk":36,"def":16,"agi":20},
            {"name":"반보로","initnum":27,"hp":25,"atk":37,"def":16,"agi":21},
            {"name":"반기노","initnum":26,"hp":24,"atk":38,"def":16,"agi":20},
            {"name":"부르돈","initnum":25,"hp":25,"atk":35,"def":14,"agi":24},
            {"name":"기라노","initnum":26,"hp":32,"atk":42,"def":19,"agi":23},
            {"name":"기비노","initnum":24,"hp":25,"atk":39,"def":13,"agi":21},
            {"name":"프로돈","initnum":25,"hp":36,"atk":39,"def":17,"agi":25},
            {"name":"메카반보로","initnum":23,"hp":31,"atk":43,"def":20,"agi":24},
            {"name":"환얀기로","initnum":27,"hp":28,"atk":36,"def":17,"agi":21,"rank":495},
            
            {"name":"쿠링","initnum":19,"hp":23,"atk":20,"def":22,"agi":24},
            {"name":"쿠쿠르","initnum":20,"hp":24,"atk":20,"def":19,"agi":26},
            {"name":"포링","initnum":18,"hp":22,"atk":20,"def":18,"agi":24},
            {"name":"리스키","initnum":17,"hp":26,"atk":18,"def":21,"agi":24},
            {"name":"노스키","initnum":18,"hp":22,"atk":22,"def":21,"agi":29},
            {"name":"라스키","initnum":17,"hp":26,"atk":30,"def":18,"agi":29},
            {"name":"토끼","initnum":17,"hp":32,"atk":30,"def":23,"agi":33},
            {"name":"범링","initnum":22,"hp":26,"atk":28,"def":20,"agi":30},
            {"name":"메카리스키","initnum":23,"hp":32,"atk":35,"def":9,"agi":41},
                        
            {"name":"카비트","initnum":18,"hp":14,"atk":19,"def":19,"agi":27},
            {"name":"케이비","initnum":20,"hp":14,"atk":19,"def":19,"agi":27},
            {"name":"큐이","initnum":15,"hp":13,"atk":20,"def":17,"agi":25},
            {"name":"골드카비트","initnum":19,"hp":16,"atk":20,"def":16,"agi":28},
            {"name":"블루카비트","initnum":21,"hp":25,"atk":24,"def":12,"agi":26},
            {"name":"연두큐이","initnum":21,"hp":23,"atk":25,"def":14,"agi":24},
            {"name":"키라비","initnum":22,"hp":21,"atk":25,"def":11,"agi":26},
            {"name":"카이비","initnum":21,"hp":22,"atk":25,"def":15,"agi":25},
                        
            {"name":"고르돈","initnum":24,"hp":27,"atk":31,"def":24,"agi":18},
            {"name":"기라돈","initnum":24,"hp":28,"atk":31,"def":22,"agi":19},
            {"name":"투르돈","initnum":24,"hp":26,"atk":28,"def":16,"agi":16},
            {"name":"고르고","initnum":24,"hp":22,"atk":29,"def":16,"agi":16},
            {"name":"철기돈","initnum":24,"hp":26,"atk":33,"def":23,"agi":21},
            {"name":"실버고르돈","initnum":27,"hp":28,"atk":30,"def":19,"agi":17},
            {"name":"고라돈","initnum":27,"hp":25,"atk":29,"def":25,"agi":15},
            {"name":"노라돈","initnum":24,"hp":28,"atk":33,"def":19,"agi":22},
            {"name":"그린고르","initnum":25,"hp":28,"atk":28,"def":30,"agi":4},
            {"name":"킹고르","initnum":25,"hp":35,"atk":38,"def":25,"agi":19},
            {"name":"그램고르","initnum":22,"hp":31,"atk":34,"def":32,"agi":19},
            {"name":"지고르","initnum":22,"hp":31,"atk":39,"def":24,"agi":21},
            {"name":"가론고르","initnum":26,"hp":31,"atk":42,"def":23,"agi":20},
            {"name":"고루바","initnum":25,"hp":31,"atk":31,"def":34,"agi":21},

            {"name":"휴보","initnum":18,"hp":26,"atk":28,"def":25,"agi":16},
            {"name":"포보","initnum":19,"hp":28,"atk":23,"def":26,"agi":14},
            {"name":"쿠보","initnum":25,"hp":26,"atk":26,"def":26,"agi":17},
            {"name":"토로쟈","initnum":21,"hp":25,"atk":26,"def":25,"agi":16},
            {"name":"부르보","initnum":20,"hp":23,"atk":25,"def":24,"agi":20},
            {"name":"푸보","initnum":18,"hp":30,"atk":30,"def":22,"agi":16},
            {"name":"타루쟈","initnum":18,"hp":26,"atk":35,"def":21,"agi":16},
            {"name":"노보","initnum":22,"hp":26,"atk":26,"def":29,"agi":24},
            
            {"name":"카쿠","initnum":18,"hp":28,"atk":29,"def":25,"agi":32},
            {"name":"바카","initnum":20,"hp":19,"atk":27,"def":20,"agi":28},
            {"name":"바우","initnum":17,"hp":18,"atk":23,"def":20,"agi":28},
            {"name":"카우","initnum":17,"hp":16,"atk":23,"def":23,"agi":26},
            {"name":"바카우","initnum":18,"hp":21,"atk":30,"def":17,"agi":29},
            {"name":"바쿠우","initnum":18,"hp":30,"atk":34,"def":20,"agi":30},
            {"name":"푸쿠","initnum":18,"hp":21,"atk":31,"def":17,"agi":28},
            {"name":"바쿠","initnum":18,"hp":24,"atk":33,"def":21,"agi":29},
                                    
            {"name":"베르가","initnum":24,"hp":24,"atk":29,"def":14,"agi":26},
            {"name":"베루루","initnum":23,"hp":21,"atk":30,"def":13,"agi":28},
            {"name":"고르고르","initnum":21,"hp":20,"atk":31,"def":13,"agi":27},
            {"name":"노르노르","initnum":25,"hp":22,"atk":30,"def":17,"agi":29},
            {"name":"도르도르","initnum":23,"hp":25,"atk":31,"def":14,"agi":28},
            {"name":"성호","initnum":24,"hp":29,"atk":32,"def":13,"agi":29},
            {"name":"고루루","initnum":25,"hp":25,"atk":32,"def":13,"agi":28},
            {"name":"페루루","initnum":26,"hp":23,"atk":32,"def":13,"agi":29},
            {"name":"베라라","initnum":25,"hp":26,"atk":35,"def":15,"agi":32},
            {"name":"하르가","initnum":22,"hp":30,"atk":37,"def":16,"agi":31},
            {"name":"검호","initnum":26,"hp":26,"atk":34,"def":14,"agi":30},
            {"name":"천호","initnum":27,"hp":26,"atk":34,"def":12,"agi":28},
            {"name":"메카르노","initnum":24,"hp":30,"atk":41,"def":17,"agi":28},
                                                                                    
            {"name":"토리노프스","initnum":12,"hp":26,"atk":21,"def":26,"agi":12},
            {"name":"펜타스","initnum":16,"hp":28,"atk":17,"def":28,"agi":11},
            {"name":"토리케라","initnum":18,"hp":27,"atk":18,"def":28,"agi":10},
            {"name":"토르프스","initnum":14,"hp":26,"atk":19,"def":29,"agi":9},
            {"name":"타노프스","initnum":16,"hp":38,"atk":24,"def":33,"agi":11},
            {"name":"노타스","initnum":14,"hp":34,"atk":26,"def":37,"agi":20},
            {"name":"코발스","initnum":15,"hp":40,"atk":25,"def":31,"agi":10},
            {"name":"타르프스","initnum":14,"hp":35,"atk":26,"def":42,"agi":11},
            
            {"name":"고반케스","initnum":20,"hp":27,"atk":33,"def":15,"agi":16},
            {"name":"쟈그라","initnum":20,"hp":26,"atk":34,"def":14,"agi":17},
            {"name":"쟈그","initnum":20,"hp":30,"atk":33,"def":13,"agi":17},
            {"name":"판지","initnum":20,"hp":29,"atk":33,"def":14,"agi":17},
            {"name":"석화케스","initnum":24,"hp":27,"atk":33,"def":15,"agi":17},
            {"name":"판그라","initnum":24,"hp":27,"atk":35,"def":15,"agi":19},
            {"name":"판그","initnum":23,"hp":28,"atk":34,"def":17,"agi":18},
            {"name":"쟈하드","initnum":24,"hp":24,"atk":34,"def":14,"agi":22},
            {"name":"메카케스","initnum":25,"hp":34,"atk":41,"def":18,"agi":24},
                                    
            {"name":"기가로스","initnum":28,"hp":30,"atk":34,"def":32,"agi":20},
            {"name":"메가로스","initnum":24,"hp":33,"atk":36,"def":33,"agi":13},
            {"name":"비트로스","initnum":25,"hp":30,"atk":37,"def":27,"agi":21},
            {"name":"가가로스","initnum":26,"hp":32,"atk":40,"def":27,"agi":15},
            {"name":"라가로스","initnum":24,"hp":38,"atk":30,"def":35,"agi":5},
            {"name":"기트로스","initnum":24,"hp":35,"atk":34,"def":31,"agi":5},
            {"name":"노트로스","initnum":26,"hp":36,"atk":33,"def":32,"agi":5},
            {"name":"돌가로스","initnum":26,"hp":32,"atk":30,"def":33,"agi":8},
            
            {"name":"루이","initnum":22,"hp":40,"atk":32,"def":33,"agi":10},
            {"name":"무이","initnum":20,"hp":44,"atk":30,"def":33,"agi":10},
            {"name":"씨보스","initnum":21,"hp":41,"atk":30,"def":35,"agi":10},
            {"name":"투이","initnum":24,"hp":39,"atk":34,"def":33,"agi":9},
            {"name":"누이","initnum":20,"hp":36,"atk":32,"def":38,"agi":10},
            {"name":"가이","initnum":20,"hp":46,"atk":33,"def":32,"agi":8},
            {"name":"루보스","initnum":20,"hp":39,"atk":32,"def":37,"agi":8},
            {"name":"노보스","initnum":20,"hp":36,"atk":34,"def":33,"agi":13},
            {"name":"다크무이","initnum":25,"hp":38,"atk":38,"def":33,"agi":6},
                                    
            {"name":"다이노","initnum":25,"hp":37,"atk":31,"def":34,"agi":6},
            {"name":"다이노스","initnum":26,"hp":46,"atk":30,"def":35,"agi":7},
            {"name":"프라키토스","initnum":24,"hp":35,"atk":35,"def":28,"agi":6},
            {"name":"스텐토스","initnum":28,"hp":45,"atk":32,"def":34,"agi":5},
            {"name":"프리토스","initnum":28,"hp":41,"atk":34,"def":33,"agi":11},
            {"name":"푸비토스","initnum":28,"hp":41,"atk":33,"def":38,"agi":8},
            {"name":"브라키오스","initnum":28,"hp":40,"atk":32,"def":39,"agi":8},
            {"name":"노라키토스","initnum":28,"hp":41,"atk":34,"def":36,"agi":10},
            {"name":"브라키우스","initnum":26,"hp":36,"atk":39,"def":33,"agi":6},
            {"name":"스텐토스","initnum":28,"hp":35,"atk":32,"def":34,"agi":5},
            {"name":"메카다이노","initnum":23,"hp":53,"atk":31,"def":35,"agi":6},

            {"name":"만모","initnum":25,"hp":47,"atk":26,"def":39,"agi":6},
            {"name":"만모르","initnum":24,"hp":45,"atk":32,"def":35,"agi":6},
            {"name":"마모나스","initnum":25,"hp":49,"atk":26,"def":37,"agi":6},
            {"name":"만모로스","initnum":25,"hp":50,"atk":28,"def":34,"agi":6},
            {"name":"메모스","initnum":25,"hp":48,"atk":27,"def":39,"agi":5},
            {"name":"푸모나스","initnum":25,"hp":53,"atk":26,"def":36,"agi":5},
            {"name":"만모드","initnum":25,"hp":45,"atk":28,"def":41,"agi":4},
            {"name":"실버로스","initnum":25,"hp":51,"atk":26,"def":37,"agi":6},
            {"name":"아이스만모","initnum":23,"hp":55,"atk":27,"def":36,"agi":4},
                                    
            {"name":"테라곤","initnum":26,"hp":24,"atk":31,"def":15,"agi":32},
            {"name":"카르곤","initnum":26,"hp":23,"atk":31,"def":13,"agi":30},
            {"name":"포이비스","initnum":24,"hp":27,"atk":34,"def":21,"agi":32},
            {"name":"도라비스","initnum":26,"hp":24,"atk":31,"def":14,"agi":33},
            {"name":"푸테라","initnum":26,"hp":27,"atk":32,"def":15,"agi":30},
            {"name":"실버라곤","initnum":26,"hp":30,"atk":34,"def":21,"agi":31},
            {"name":"테라돈","initnum":25,"hp":35,"atk":33,"def":16,"agi":32},
            {"name":"보르비스","initnum":25,"hp":31,"atk":38,"def":17,"agi":29},
            {"name":"골드테라곤","initnum":26,"hp":24,"atk":31,"def":16,"agi":32},
            {"name":"테라비스","initnum":25,"hp":28,"atk":35,"def":15,"agi":36},
            {"name":"메카비스","initnum":23,"hp":30,"atk":37,"def":12,"agi":37},
                                    
            {"name":"타키","initnum":20,"hp":19,"atk":22,"def":10,"agi":35},
            {"name":"쿠쿠","initnum":20,"hp":18,"atk":22,"def":10,"agi":36},
            {"name":"호르쿠","initnum":20,"hp":20,"atk":21,"def":12,"agi":34},
            {"name":"카키","initnum":20,"hp":17,"atk":23,"def":11,"agi":33},
            {"name":"타르쿠","initnum":20,"hp":20,"atk":22,"def":13,"agi":33},
            {"name":"푸타카","initnum":20,"hp":22,"atk":21,"def":12,"agi":34},
            {"name":"흑카키","initnum":18,"hp":23,"atk":24,"def":15,"agi":40},
            {"name":"쥬키","initnum":19,"hp":19,"atk":25,"def":10,"agi":32},
            {"name":"다르쿠","initnum":20,"hp":23,"atk":26,"def":8,"agi":36},
            {"name":"환카키","initnum":20,"hp":18,"atk":23,"def":11,"agi":34,"rank":555},
                                                
            {"name":"오가로스","initnum":24,"hp":30,"atk":37,"def":28,"agi":20},
            {"name":"오르곤","initnum":26,"hp":33,"atk":38,"def":22,"agi":24},
            {"name":"모가로스","initnum":25,"hp":27,"atk":40,"def":19,"agi":28},
            {"name":"골로스","initnum":26,"hp":28,"atk":40,"def":21,"agi":25},
            {"name":"칼로스","initnum":25,"hp":26,"atk":35,"def":17,"agi":26},
            {"name":"지가로스","initnum":25,"hp":27,"atk":34,"def":22,"agi":21},
            {"name":"푸룡","initnum":25,"hp":31,"atk":40,"def":18,"agi":28},
            {"name":"흑귀","initnum":26,"hp":30,"atk":42,"def":18,"agi":25},
            {"name":"카르노스","initnum":25,"hp":28,"atk":39,"def":20,"agi":28},
            {"name":"노르곤","initnum":26,"hp":27,"atk":38,"def":17,"agi":27},
            {"name":"로제로스","initnum":24,"hp":27,"atk":40,"def":16,"agi":30},
            {"name":"파베로스","initnum":24,"hp":28,"atk":38,"def":15,"agi":33},
            {"name":"카가로스","initnum":25,"hp":26,"atk":40,"def":14,"agi":23},
            {"name":"암흑골로스","initnum":26,"hp":24,"atk":37,"def":16,"agi":26},
            {"name":"주로스","initnum":24,"hp":29,"atk":41,"def":21,"agi":25},
            {"name":"아르로스","initnum":25,"hp":31,"atk":42,"def":22,"agi":23},
            {"name":"다크로스","initnum":25,"hp":29,"atk":43,"def":21,"agi":24},
            {"name":"그린바로스","initnum":23,"hp":32,"atk":44,"def":18,"agi":24},
            {"name":"바로스","initnum":24,"hp":29,"atk":39,"def":17,"agi":31},
            {"name":"설곤","initnum":25,"hp":30,"atk":42,"def":15,"agi":29},
            
            {"name":"프이토","initnum":26,"hp":19,"atk":22,"def":25,"agi":29},
            {"name":"모나시프","initnum":25,"hp":23,"atk":23,"def":24,"agi":28},
            {"name":"라나프","initnum":28,"hp":18,"atk":26,"def":24,"agi":29},
            {"name":"라이혼","initnum":26,"hp":26,"atk":34,"def":25,"agi":32},
            {"name":"타이혼","initnum":26,"hp":24,"atk":36,"def":22,"agi":33},
            {"name":"차이혼","initnum":28,"hp":28,"atk":28,"def":25,"agi":34},
            {"name":"파라프","initnum":28,"hp":27,"atk":27,"def":24,"agi":36},
            {"name":"모이토","initnum":27,"hp":22,"atk":26,"def":29,"agi":32},
            {"name":"타이혼","initnum":26,"hp":24,"atk":36,"def":22,"agi":33},
            {"name":"메카타이혼","initnum":22,"hp":29,"atk":38,"def":16,"agi":33},
            
            {"name":"스토라지","initnum":21,"hp":35,"atk":26,"def":23,"agi":20},
            {"name":"아토라지","initnum":20,"hp":39,"atk":29,"def":24,"agi":23},
            {"name":"아리노스","initnum":26,"hp":34,"atk":26,"def":25,"agi":19},
            {"name":"다이노로스","initnum":24,"hp":36,"atk":32,"def":23,"agi":25},
            {"name":"타르노로스","initnum":23,"hp":40,"atk":31,"def":24,"agi":24},
            {"name":"노리노스","initnum":23,"hp":34,"atk":26,"def":32,"agi":27},
            {"name":"푸토라지","initnum":23,"hp":38,"atk":26,"def":31,"agi":20},
            {"name":"코리노로스","initnum":26,"hp":30,"atk":32,"def":28,"agi":28},
            
            {"name":"바로로크스","initnum":22,"hp":24,"atk":19,"def":24,"agi":18},
            {"name":"란베르스","initnum":21,"hp":26,"atk":21,"def":21,"agi":22},
            {"name":"코리토르스","initnum":19,"hp":24,"atk":20,"def":22,"agi":20},
            {"name":"노스토로스","initnum":23,"hp":22,"atk":25,"def":20,"agi":24},
            {"name":"노로로크스","initnum":23,"hp":26,"atk":29,"def":22,"agi":27},
            {"name":"실버로크스","initnum":25,"hp":29,"atk":30,"def":23,"agi":25},
            {"name":"디로로크스","initnum":24,"hp":25,"atk":28,"def":21,"agi":28},
            {"name":"진주토로스","initnum":24,"hp":30,"atk":27,"def":22,"agi":20},
            
            {"name":"황호","initnum":25,"hp":27,"atk":37,"def":18,"agi":31},
            {"name":"청호","initnum":25,"hp":29,"atk":39,"def":20,"agi":27},
            {"name":"흑호","initnum":25,"hp":28,"atk":35,"def":16,"agi":35},
            {"name":"이블티거","initnum":25,"hp":24,"atk":35,"def":14,"agi":25},
            {"name":"백호","initnum":24,"hp":31,"atk":42,"def":21,"agi":23},
            {"name":"로데오","initnum":24,"hp":29,"atk":41,"def":18,"agi":28},
            {"name":"가우","initnum":25,"hp":30,"atk":40,"def":19,"agi":28},
            
            {"name":"포루나","initnum":23,"hp":27,"atk":31,"def":13,"agi":30},
            {"name":"피피아","initnum":23,"hp":24,"atk":29,"def":14,"agi":29},
            {"name":"사루나","initnum":23,"hp":21,"atk":26,"def":10,"agi":35},
            
            {"name":"포레스트크랩","initnum":24,"hp":43,"atk":32,"def":36,"agi":5},
            {"name":"크랩","initnum":21,"hp":33,"atk":36,"def":26,"agi":21},
            {"name":"핑크랩","initnum":25,"hp":34,"atk":36,"def":32,"agi":5},
            {"name":"킹크랩","initnum":21,"hp":40,"atk":38,"def":34,"agi":6},
            {"name":"스톤크랩","initnum":24,"hp":38,"atk":32,"def":40,"agi":4},
                                    
            {"name":"지라크","initnum":23,"hp":30,"atk":27,"def":17,"agi":29},
            {"name":"타이판","initnum":23,"hp":25,"atk":33,"def":17,"agi":19},
            {"name":"파이톤","initnum":23,"hp":26,"atk":36,"def":17,"agi":24},
            {"name":"바이퍼","initnum":24,"hp":25,"atk":34,"def":16,"agi":28},
            {"name":"포보스","initnum":24,"hp":26,"atk":33,"def":24,"agi":21},
            
            {"name":"아코로비","initnum":25,"hp":31,"atk":38,"def":19,"agi":27},
            {"name":"골드로비","initnum":26,"hp":22,"atk":29,"def":14,"agi":28},
            
            {"name":"토라","initnum":26,"hp":21,"atk":26,"def":12,"agi":26},
            {"name":"페르페","initnum":26,"hp":23,"atk":25,"def":11,"agi":24},
            {"name":"슈우","initnum":26,"hp":21,"atk":29,"def":17,"agi":14},
            {"name":"미니스","initnum":26,"hp":23,"atk":28,"def":12,"agi":24},
            
            {"name":"발로스","initnum":22,"hp":27,"atk":39,"def":16,"agi":29},
            {"name":"데블로스","initnum":21,"hp":24,"atk":32,"def":13,"agi":29},

            {"name":"스노밍코","initnum":20,"hp":30,"atk":22,"def":20,"agi":33},
            {"name":"밍코","initnum":19,"hp":30,"atk":34,"def":11,"agi":31},
            {"name":"링코","initnum":22,"hp":43,"atk":30,"def":14,"agi":33},
            {"name":"한복밍코","initnum":26,"hp":26,"atk":34,"def":14,"agi":34},
                        
            {"name":"쿠아","initnum":24,"hp":23,"atk":29,"def":16,"agi":25},
            {"name":"쿠팡","initnum":23,"hp":19,"atk":30,"def":10,"agi":27},
            
            {"name":"크루거","initnum":24,"hp":30,"atk":35,"def":17,"agi":33},
            {"name":"카우거","initnum":25,"hp":29,"atk":39,"def":14,"agi":33},
            {"name":"볼케","initnum":24,"hp":27,"atk":38,"def":15,"agi":33},
            {"name":"이구로스","initnum":25,"hp":27,"atk":35,"def":18,"agi":29},
                        
            {"name":"기로아치","initnum":24,"hp":30,"atk":40,"def":16,"agi":28},
            {"name":"크로아치","initnum":23,"hp":30,"atk":39,"def":21,"agi":25},
            {"name":"마루아치","initnum":26,"hp":28,"atk":40,"def":18,"agi":23},
                        
            {"name":"도에디크","initnum":27,"hp":30,"atk":34,"def":32,"agi":13},
            
            {"name":"레이론","initnum":24,"hp":26,"atk":34,"def":19,"agi":20},
            {"name":"샤크론","initnum":24,"hp":32,"atk":37,"def":15,"agi":33},
            {"name":"다크론","initnum":24,"hp":33,"atk":41,"def":20,"agi":24},
            {"name":"차크론","initnum":24,"hp":26,"atk":34,"def":11,"agi":28},
            {"name":"아크론","initnum":25,"hp":32,"atk":38,"def":14,"agi":33},
            {"name":"마크론","initnum":24,"hp":28,"atk":42,"def":17,"agi":28},
            {"name":"치크론","initnum":23,"hp":27,"atk":37,"def":13,"agi":32},
                        
            {"name":"디메트로돈","initnum":23,"hp":42,"atk":33,"def":38,"agi":3},
            {"name":"비트로돈","initnum":22,"hp":29,"atk":35,"def":27,"agi":23},
            
            {"name":"갈푸스","initnum":24,"hp":27,"atk":40,"def":14,"agi":33},
            //{"name":"베르푸스","initnum":26,"hp":21,"atk":30,"def":12,"agi":26,"rank":535}, // 89, 535
            //{"name":"울푸스","initnum":26,"hp":23,"atk":28,"def":11,"agi":25,"rank":555},   // 87, 555
            //{"name":"볼프","initnum":26,"hp":22,"atk":32,"def":17,"agi":15,"rank":555},     // 86, 555
            {"name":"델푸스","initnum":24,"hp":24,"atk":33,"def":12,"agi":25},
            {"name":"흑갈푸스","initnum":22,"hp":27,"atk":39,"def":15,"agi":33},
            {"name":"롤프","initnum":24,"hp":28,"atk":40,"def":16,"agi":31},
                                    
            {"name":"아르마루","initnum":25,"hp":28,"atk":37,"def":17,"agi":27},
            {"name":"베르마루","initnum":27,"hp":27,"atk":36,"def":15,"agi":25},
            {"name":"구루마루","initnum":25,"hp":30,"atk":40,"def":17,"agi":29},
            {"name":"헤르마루","initnum":23,"hp":29,"atk":41,"def":16,"agi":29},
            {"name":"부루마루","initnum":25,"hp":31,"atk":41,"def":16,"agi":29},
            {"name":"가르마루","initnum":24,"hp":30,"atk":41,"def":18,"agi":28},
                        
            {"name":"호르카","initnum":25,"hp":25,"atk":28,"def":18,"agi":25},

            {"name":"펠트르돈","initnum":26,"hp":27,"atk":35,"def":17,"agi":22},
            {"name":"델타르돈","initnum":23,"hp":27,"atk":33,"def":22,"agi":22},
            {"name":"카르카로돈","initnum":23,"hp":25,"atk":32,"def":15,"agi":27},
            
            {"name":"푸타푸타","initnum":25,"hp":23,"atk":29,"def":12,"agi":33},
            
            {"name":"후바티","initnum":23,"hp":33,"atk":39,"def":24,"agi":22},
            {"name":"노바티","initnum":21,"hp":28,"atk":39,"def":21,"agi":27},
                        
            {"name":"키파","initnum":25,"hp":24,"atk":33,"def":15,"agi":26},
            {"name":"히파","initnum":24,"hp":26,"atk":33,"def":10,"agi":39,"rank":455},
                        
            {"name":"테로노돈","initnum":25,"hp":27,"atk":30,"def":12,"agi":33},
            {"name":"익시노돈","initnum":26,"hp":24,"atk":29,"def":11,"agi":33},
            
            {"name":"샤베르","initnum":24,"hp":25,"atk":31,"def":14,"agi":28},
            {"name":"타키온","initnum":24,"hp":27,"atk":29,"def":12,"agi":26},

            {"name":"라이쿠스","initnum":24,"hp":43,"atk":33,"def":38,"agi":6},
            {"name":"바라쿠스","initnum":24,"hp":42,"atk":31,"def":39,"agi":7},
            {"name":"헤라쿠스","initnum":22,"hp":42,"atk":33,"def":37,"agi":5},
            {"name":"타이쿠스","initnum":23,"hp":42,"atk":37,"def":37,"agi":3},
            
            {"name":"어린흑룡","initnum":26,"hp":25,"atk":33,"def":13,"agi":29},
            {"name":"어린백룡","initnum":24,"hp":25,"atk":30,"def":15,"agi":25},
            {"name":"어린청룡","initnum":26,"hp":36,"atk":43,"def":14,"agi":22},
            
            {"name":"메피노","initnum":25,"hp":30,"atk":41,"def":19,"agi":26},
            {"name":"스피노","initnum":26,"hp":29,"atk":43,"def":17,"agi":26},
            {"name":"야크노","initnum":26,"hp":25,"atk":35,"def":17,"agi":22},
            {"name":"엘피노","initnum":25,"hp":28,"atk":40,"def":19,"agi":22},
            
            {"name":"흑주작","initnum":24,"hp":25,"atk":36,"def":13,"agi":25},
            {"name":"아스타로","initnum":23,"hp":27,"atk":35,"def":11,"agi":41},
            {"name":"어린주작","initnum":28,"hp":22,"atk":28,"def":10,"agi":26},
            {"name":"어린청주작","initnum":27,"hp":20,"atk":26,"def":8,"agi":27},

            {"name":"흑풍","initnum":25,"hp":29,"atk":38,"def":14,"agi":34},
            {"name":"어린풍백","initnum":33,"hp":21,"atk":26,"def":10,"agi":25},

            //{"name":"흑룡","initnum":26,"hp":26,"atk":35,"def":13,"agi":30},
            //{"name":"백룡","initnum":24,"hp":25,"atk":34,"def":15,"agi":25},
            {"name":"메카청룡","initnum":25,"hp":34,"atk":42,"def":15,"agi":28},
            
            {"name":"흑기린","initnum":24,"hp":26,"atk":40,"def":18,"agi":19},
            {"name":"기린","initnum":24,"hp":30,"atk":41,"def":21,"agi":22},
            {"name":"기란","initnum":24,"hp":28,"atk":38,"def":20,"agi":22},
            {"name":"백기린","initnum":24,"hp":32,"atk":43,"def":21,"agi":21},

            {"name":"우라노스","initnum":27,"hp":23,"atk":29,"def":11,"agi":26},
            {"name":"불카노스","initnum":24,"hp":27,"atk":38,"def":15,"agi":33},
            {"name":"헬노스","initnum":23,"hp":28,"atk":38,"def":11,"agi":38},

            {"name":"아비시니안","initnum":26,"hp":23,"atk":31,"def":14,"agi":25},
            
            {"name":"바우트","initnum":26,"hp":38,"atk":39,"def":36,"agi":4},
            {"name":"토우트","initnum":26,"hp":45,"atk":34,"def":36,"agi":7},
            {"name":"타우트","initnum":27,"hp":40,"atk":38,"def":36,"agi":4},
            {"name":"샤우트","initnum":25,"hp":44,"atk":35,"def":35,"agi":9},
            
            {"name":"모사크","initnum":23,"hp":32,"atk":40,"def":17,"agi":28},
            {"name":"디사크","initnum":22,"hp":30,"atk":42,"def":17,"agi":28},
            
            {"name":"블랙펄","initnum":25,"hp":25,"atk":35,"def":14,"agi":29},
            {"name":"블루문","initnum":25,"hp":30,"atk":39,"def":17,"agi":28},
                        
            {"name":"쿠오코마","initnum":26,"hp":39,"atk":36,"def":31,"agi":9},
            {"name":"웅이","initnum":26,"hp":42,"atk":35,"def":33,"agi":8},
            
            {"name":"흑토끼","initnum":24,"hp":28,"atk":36,"def":22,"agi":18},
            {"name":"백설토끼","initnum":24,"hp":43,"atk":33,"def":37,"agi":4},

            {"name":"어린현무","initnum":24,"hp":47,"atk":29,"def":37,"agi":6},
            
            {"name":"야무리","initnum":27,"hp":30,"atk":34,"def":10,"agi":20},
            {"name":"둠바로스","initnum":24,"hp":39,"atk":39,"def":33,"agi":4},
                        
            {"name":"케라스","initnum":26,"hp":32,"atk":41,"def":21,"agi":23},
            {"name":"쿠라스","initnum":26,"hp":29,"atk":39,"def":13,"agi":34},

            {"name":"한가름","initnum":25,"hp":32,"atk":42,"def":16,"agi":28},
            {"name":"막쿠마","initnum":24,"hp":26,"atk":34,"def":9,"agi":39},

            {"name":"자쿠이노","initnum":26,"hp":35,"atk":39,"def":26,"agi":19},

            {"name":"페리스","initnum":24,"hp":38,"atk":37,"def":30,"agi":4},
            
            {"name":"깜아리","initnum":22,"hp":32,"atk":38,"def":13,"agi":33},
            {"name":"홍아리","initnum":24,"hp":21,"atk":29,"def":11,"agi":35},

            {"name":"펭펭","initnum":26,"hp":29,"atk":37,"def":20,"agi":23},
            {"name":"흑돌","initnum":25,"hp":33,"atk":38,"def":22,"agi":23},
            
            {"name":"팽돌","initnum":24,"hp":42,"atk":37,"def":33,"agi":4},
            {"name":"돌핀","initnum":26,"hp":28,"atk":41,"def":17,"agi":28},

            {"name":"델피누스","initnum":24,"hp":25,"atk":30,"def":12,"agi":32},
            {"name":"엘피누스","initnum":25,"hp":23,"atk":31,"def":11,"agi":33},

            {"name":"셀르프","initnum":24,"hp":37,"atk":32,"def":34,"agi":5},

            {"name":"봉봉","initnum":26,"hp":30,"atk":41,"def":19,"agi":26},

            {"name":"라이칸","initnum":25,"hp":24,"atk":34,"def":17,"agi":19},

            {"name":"나비드래곤","initnum":25,"hp":29,"atk":39,"def":15,"agi":32},
            {"name":"블랙드래곤","initnum":25,"hp":28,"atk":42,"def":16,"agi":29},
            {"name":"어린골드드래곤","initnum":24,"hp":26,"atk":34,"def":10,"agi":40},
            {"name":"어린아이스드래곤","initnum":28,"hp":25,"atk":33,"def":11,"agi":21},
            {"name":"어린어스드래곤","initnum":24,"hp":32,"atk":41,"def":17,"agi":22},
            {"name":"어린레드드래곤","initnum":24,"hp":28,"atk":41,"def":13,"agi":28},
            
            {"name":"한복메이","initnum":26,"hp":27,"atk":39,"def":19,"agi":23},

            {"name":"베이클","initnum":24,"hp":29,"atk":39,"def":18,"agi":23},

            {"name":"각수","initnum":25,"hp":28,"atk":38,"def":16,"agi":27},
            {"name":"격수","initnum":23,"hp":30,"atk":40,"def":17,"agi":28},

            {"name":"싸이클론","initnum":24,"hp":30,"atk":39,"def":28,"agi":19},

            {"name":"타르톤","initnum":26,"hp":38,"atk":37,"def":37,"agi":4},
            
            {"name":"밤미","initnum":25,"hp":27,"atk":34,"def":15,"agi":37},

            {"name":"아누","initnum":24,"hp":25,"atk":33,"def":14,"agi":29},
            {"name":"카누","initnum":24,"hp":26,"atk":34,"def":14,"agi":28},

            {"name":"토로카","initnum":23,"hp":30,"atk":42,"def":20,"agi":24},
            {"name":"아르카","initnum":24,"hp":25,"atk":34,"def":13,"agi":30},
            
            {"name":"메이","initnum":24,"hp":25,"atk":33,"def":14,"agi":31},
            {"name":"토르","initnum":23,"hp":32,"atk":39,"def":22,"agi":25},

            {"name":"문울프","initnum":25,"hp":29,"atk":36,"def":16,"agi":33},
            {"name":"다크울프","initnum":23,"hp":28,"atk":38,"def":15,"agi":32},
            {"name":"번울프","initnum":25,"hp":26,"atk":37,"def":16,"agi":30},
            
            {"name":"다크야무","initnum":25,"hp":37,"atk":40,"def":31,"agi":5},

            {"name":"라그노스","initnum":25,"hp":41,"atk":39,"def":34,"agi":4},
            {"name":"크로톤","initnum":25,"hp":33,"atk":40,"def":20,"agi":25},
            {"name":"타우루스","initnum":22,"hp":40,"atk":35,"def":37,"agi":6},

            {"name":"크라우","initnum":25,"hp":28,"atk":38,"def":16,"agi":27},
            {"name":"싸가트","initnum":25,"hp":30,"atk":43,"def":17,"agi":26},
            {"name":"파사트","initnum":25,"hp":28,"atk":38,"def":17,"agi":21},

            {"name":"플라티우스","initnum":25,"hp":28,"atk":29,"def":13,"agi":20},
            {"name":"프라미우스","initnum":25,"hp":24,"atk":28,"def":15,"agi":23},

            {"name":"아마란","initnum":25,"hp":27,"atk":31,"def":11,"agi":25},
            {"name":"고오다","initnum":25,"hp":23,"atk":29,"def":8,"agi":32},
            {"name":"로즈란","initnum":25,"hp":26,"atk":34,"def":12,"agi":21},
            {"name":"로오다","initnum":25,"hp":23,"atk":25,"def":7,"agi":31},

            {"name":"스켈렉스","initnum":25,"hp":30,"atk":43,"def":20,"agi":23},
            {"name":"스켈록스","initnum":26,"hp":24,"atk":39,"def":16,"agi":20},
            {"name":"본드래곤","initnum":25,"hp":31,"atk":42,"def":16,"agi":28},

            {"name":"우마왕","initnum":23,"hp":30,"atk":39,"def":28,"agi":19},
            {"name":"흑마왕","initnum":23,"hp":31,"atk":39,"def":20,"agi":28},

            {"name":"마그노","initnum":23,"hp":32,"atk":34,"def":16,"agi":21},
            {"name":"머그노","initnum":22,"hp":29,"atk":36,"def":17,"agi":21},
            
            {"name":"푸로비","initnum":26,"hp":26,"atk":35,"def":12,"agi":31},
            {"name":"화이트쟈그","initnum":24,"hp":42,"atk":35,"def":35,"agi":8},
            {"name":"산타베르가","initnum":25,"hp":29,"atk":39,"def":15,"agi":33},
            {"name":"리바이어던","initnum":24,"hp":53,"atk":30,"def":34,"agi":5},
            {"name":"만모베베","initnum":25,"hp":43,"atk":38,"def":31,"agi":7},
            {"name":"크람푸스","initnum":23,"hp":29,"atk":39,"def":15,"agi":33},
            {"name":"만모링","initnum":23,"hp":32,"atk":41,"def":23,"agi":20},
            {"name":"산타로스","initnum":23,"hp":38,"atk":37,"def":35,"agi":7},
            {"name":"링코링","initnum":17,"hp":27,"atk":30,"def":20,"agi":27},
            {"name":"프로스비","initnum":22,"hp":30,"atk":40,"def":17,"agi":27},
            {"name":"산타링코","initnum":23,"hp":28,"atk":31,"def":26,"agi":32},

            {"name":"킹라쿠","initnum":24,"hp":23,"atk":29,"def":12,"agi":34},
            {"name":"차란라쿠","initnum":24,"hp":22,"atk":28,"def":12,"agi":34},
            {"name":"칼란라쿠","initnum":24,"hp":23,"atk":26,"def":12,"agi":32},
            {"name":"메이밍","initnum":26,"hp":26,"atk":35,"def":15,"agi":32},
            {"name":"킹꼬미","initnum":24,"hp":28,"atk":39,"def":15,"agi":27},
            {"name":"체루루","initnum":26,"hp":26,"atk":36,"def":13,"agi":32},

            {"name":"해태","initnum":24,"hp":30,"atk":39,"def":22,"agi":25},
            {"name":"해치","initnum":25,"hp":25,"atk":33,"def":14,"agi":31},
            {"name":"도철","initnum":24,"hp":31,"atk":41,"def":20,"agi":24},
            
            {"name":"아리","initnum":24,"hp":22,"atk":28,"def":11,"agi":36},
            {"name":"테이노스","initnum":23,"hp":35,"atk":42,"def":19,"agi":24},
            {"name":"백여우","initnum":25,"hp":27,"atk":36,"def":16,"agi":25},

            {"name":"메카카키","initnum":17,"hp":26,"atk":32,"def":12,"agi":45},
            {"name":"지룡","initnum":25,"hp":29,"atk":41,"def":19,"agi":27},
            {"name":"하트링","initnum":22,"hp":25,"atk":28,"def":17,"agi":31},
            {"name":"노론","initnum":25,"hp":28,"atk":39,"def":19,"agi":22},
            {"name":"피노","initnum":22,"hp":29,"atk":41,"def":16,"agi":28},
            {"name":"라피노","initnum":25,"hp":32,"atk":41,"def":18,"agi":25},
            {"name":"글루밍","initnum":22,"hp":26,"atk":36,"def":15,"agi":30},
            {"name":"글루문","initnum":22,"hp":29,"atk":39,"def":17,"agi":29},
            {"name":"바쿰","initnum":26,"hp":43,"atk":34,"def":35,"agi":6},

            {"name":"흑뱀","initnum":24,"hp":30,"atk":38,"def":17,"agi":32},
            {"name":"풍뱀","initnum":25,"hp":26,"atk":30,"def":14,"agi":35},
            {"name":"불뱀","initnum":25,"hp":26,"atk":35,"def":15,"agi":24},
            {"name":"물뱀","initnum":25,"hp":28,"atk":34,"def":17,"agi":21},
            {"name":"땅뱀","initnum":25,"hp":28,"atk":36,"def":17,"agi":24},
            {"name":"동가리","initnum":24,"hp":26,"atk":33,"def":14,"agi":29},
            {"name":"둥가리","initnum":24,"hp":25,"atk":33,"def":13,"agi":31},

            {"name":"팽팽","initnum":22,"hp":31,"atk":28,"def":45,"agi":3},

            {"name":"헷지","initnum":24,"hp":40,"atk":33,"def":36,"agi":8},

            {"name":"크로커","initnum":24,"hp":33,"atk":40,"def":21,"agi":24},
            {"name":"크로그","initnum":24,"hp":29,"atk":41,"def":22,"agi":23},

            {"name":"크토돈","initnum":24,"hp":29,"atk":43,"def":15,"agi":28},
            {"name":"노아돈","initnum":24,"hp":27,"atk":44,"def":16,"agi":27},

            {"name":"루비","initnum":23,"hp":40,"atk":39,"def":33,"agi":5},

            {"name":"바이론","initnum":23,"hp":31,"atk":42,"def":21,"agi":22},

            {"name":"헬베로스","initnum":24,"hp":28,"atk":42,"def":14,"agi":30},
            {"name":"엘베로스","initnum":23,"hp":31,"atk":41,"def":15,"agi":31},
            {"name":"켈베로스","initnum":23,"hp":33,"atk":41,"def":15,"agi":30},

            {"name":"복덩이","initnum":25,"hp":44,"atk":34,"def":36,"agi":8},

            {"name":"타무르","initnum":25,"hp":30,"atk":45,"def":18,"agi":24},

            {"name":"리어룬","initnum":24,"hp":29,"atk":41,"def":18,"agi":29},
            {"name":"시어룬","initnum":24,"hp":25,"atk":34,"def":12,"agi":28},
            {"name":"디어룬","initnum":23,"hp":28,"atk":37,"def":12,"agi":38},

            {"name":"카라고니스","initnum":25,"hp":24,"atk":32,"def":14,"agi":33},
            {"name":"트라고니스","initnum":19,"hp":28,"atk":32,"def":13,"agi":43},

            {"name":"티렉스","initnum":25,"hp":28,"atk":39,"def":16,"agi":26},
            {"name":"라우렉스","initnum":25,"hp":29,"atk":42,"def":16,"agi":28},

            {"name":"밴더스네처","initnum":25,"hp":34,"atk":42,"def":24,"agi":19},

            {"name":"미도미도","initnum":24,"hp":27,"atk":37,"def":16,"agi":24},
            {"name":"코도코도","initnum":25,"hp":27,"atk":36,"def":18,"agi":23},
            {"name":"피도피도","initnum":25,"hp":25,"atk":38,"def":17,"agi":23},

            {"name":"코무시","initnum":22,"hp":48,"atk":32,"def":36,"agi":3},
            {"name":"코르코","initnum":23,"hp":50,"atk":29,"def":37,"agi":3},

            {"name":"베르고","initnum":23,"hp":34,"atk":42,"def":27,"agi":16},

            {"name":"닉스","initnum":23,"hp":28,"atk":37,"def":12,"agi":38},

            {"name":"지발리","initnum":24,"hp":45,"atk":35,"def":38,"agi":4},
            {"name":"파르체","initnum":24,"hp":34,"atk":41,"def":16,"agi":29},
            {"name":"샤르체","initnum":24,"hp":31,"atk":45,"def":17,"agi":25},
            {"name":"슈발리","initnum":24,"hp":30,"atk":40,"def":14,"agi":33},

            {"name":"나노티라노스","initnum":24,"hp":29,"atk":39,"def":14,"agi":34},
            {"name":"도라오닉스","initnum":24,"hp":28,"atk":38,"def":11,"agi":39},

            {"name":"헤머드","initnum":23,"hp":33,"atk":44,"def":18,"agi":24},

            {"name":"티라누스","initnum":24,"hp":30,"atk":43,"def":14,"agi":29},

            {"name":"마그북","initnum":25,"hp":39,"atk":36,"def":37,"agi":4},

            {"name":"가루다","initnum":25,"hp":24,"atk":33,"def":14,"agi":32},

            {"name":"라이비","initnum":24,"hp":27,"atk":36,"def":12,"agi":38},

            {"name":"베라냐","initnum":25,"hp":27,"atk":39,"def":15,"agi":23},
            
            {"name":"프리쉴라","initnum":26,"hp":23,"atk":33,"def":15,"agi":23},
            {"name":"프리벨라","initnum":28,"hp":22,"atk":34,"def":14,"agi":24},

            {"name":"루토","initnum":23,"hp":30,"atk":37,"def":30,"agi":19},
            {"name":"블리","initnum":27,"hp":35,"atk":39,"def":24,"agi":20},
            {"name":"레디","initnum":24,"hp":43,"atk":40,"def":30,"agi":5},
            {"name":"옐로비","initnum":24,"hp":29,"atk":34,"def":15,"agi":37},

            {"name":"아르체","initnum":27,"hp":31,"atk":41,"def":18,"agi":27},

            {"name":"물범","initnum":23,"hp":45,"atk":37,"def":33,"agi":4},
        ];

        let btnName = "";
        const result = [];

        // 스크롤
        // 사용자가 문서 상단에서 50px 아래로 스크롤 할 때 버튼을 표시합니다.
        window.onscroll = function() {scrollFunction()};
        function scrollFunction() {
            if (document.body.scrollTop > 50 || document.documentElement.scrollTop > 50) {
                btnTop.style.display = "block";
            } else {
                btnTop.style.display = "none";
            }
        }

        function setSRank(copiedPet) {

            $(".srank").remove();

            let rank = 0;
            if (copiedPet.rank > 0) {
                rank = copiedPet.rank;
            }
            else if (copiedPet.hp + copiedPet.atk + copiedPet.def + copiedPet.agi >= 110) {
                rank = 435;
            }
            else if (copiedPet.hp + copiedPet.atk + copiedPet.def + copiedPet.agi >= 105) {
                rank = 455;
            }
            else if (copiedPet.hp + copiedPet.atk + copiedPet.def + copiedPet.agi >= 100) {
                rank = 475;
            }
            else if (copiedPet.hp + copiedPet.atk + copiedPet.def + copiedPet.agi >= 95) {
                rank = 495;
            }
            else if (copiedPet.hp + copiedPet.atk + copiedPet.def + copiedPet.agi >= 90) {
                rank = 515;
            }
            else if (copiedPet.hp + copiedPet.atk + copiedPet.def + copiedPet.agi >= 85) {
                rank = 535;
            }
            else if (copiedPet.hp + copiedPet.atk + copiedPet.def + copiedPet.agi >= 80) {
                rank = 555;
            }
            else if (copiedPet.hp + copiedPet.atk + copiedPet.def + copiedPet.agi >= 0) {
                rank = 575;
            }

            // base
            copiedPet.hp  = copiedPet.hp  + 2;
            copiedPet.atk = copiedPet.atk + 2;
            copiedPet.def = copiedPet.def + 2;
            copiedPet.agi = copiedPet.agi + 2;
            
            // bonus
            copiedPet.hp  = copiedPet.hp  + 2.5;
            copiedPet.atk = copiedPet.atk + 2.5;
            copiedPet.def = copiedPet.def + 2.5;
            copiedPet.agi = copiedPet.agi + 2.5;

            // 계산
            const hp  = preciseRound(copiedPet.initnum * copiedPet.hp  / 100);
            const atk = preciseRound(copiedPet.initnum * copiedPet.atk / 100);
            const def = preciseRound(copiedPet.initnum * copiedPet.def / 100);
            const agi = preciseRound(copiedPet.initnum * copiedPet.agi / 100);

            const resultHp  = preciseRound((hp * 4) + atk + def + agi);
            const resultAtk = preciseRound((hp * 0.1) + atk + (def * 0.1) + (agi * 0.05));
            const resultDef = preciseRound((hp * 0.1) + (atk * 0.1) + def + (agi * 0.05));
            const resultAgi = agi;

            const upHp  = preciseRound(copiedPet.hp  * rank / 10000);
            const upAtk = preciseRound(copiedPet.atk * rank / 10000);
            const upDef = preciseRound(copiedPet.def * rank / 10000);
            const upAgi = preciseRound(copiedPet.agi * rank / 10000);
            
            const resultUpHp  = preciseRound((upHp * 4) + upAtk + upDef + upAgi);
            const resultUpAtk = preciseRound((upHp * 0.1) + upAtk + (upDef * 0.1) + (upAgi * 0.05));
            const resultUpDef = preciseRound((upHp * 0.1) + (upAtk * 0.1) + upDef + (upAgi * 0.05));
            const resultUpAgi = upAgi;
            const resultSum   = preciseRound(resultUpAtk + resultUpDef + resultUpAgi);

            $('#myPet tbody').append(''
                + '<tr class="srank">'
                + '<td>S 초기치</td>'
                + '<td>' + limitDecimalPlaces(resultHp, 2) + '</td>'
                + '<td>' + limitDecimalPlaces(resultAtk, 2) + '</td>'
                + '<td>' + limitDecimalPlaces(resultDef, 2) + '</td>'
                + '<td>' + limitDecimalPlaces(resultAgi, 2) + '</td>'
                + '<td>' + '' + '</td>'
                + '</tr>'
                + '<tr class="srank">'
                + '<td>S 성장률</td>'
                + '<td>' + resultUpHp.toFixed(2) + '</td>'
                + '<td>' + resultUpAtk.toFixed(2) + '</td>'
                + '<td>' + resultUpDef.toFixed(2) + '</td>'
                + '<td>' + resultUpAgi.toFixed(2) + '</td>'
                + '<td>' + resultSum.toFixed(2) + '</td>'
                + '</tr>'
            );

            if (btnName == "search") {
                $("#hp").val(parseInt(resultHp, 10));
                $("#atk").val(parseInt(resultAtk, 10));
                $("#def").val(parseInt(resultDef, 10));
                $("#agi").val(parseInt(resultAgi, 10));
            }

            //$("#memo").append(resultHp);
        }

        function setBase(foundPet) {

            $('#result tbody').empty();
            result.length = 0;

            const baseCnt = 5;
            const baseInit = -2;
            const base = {"hp":-2,"atk":-2,"def":-2,"agi":-2};
            //const baseCnt = 6;
            //const baseInit = -3;
            //const base = {"hp":-3,"atk":-3,"def":-3,"agi":-3}; // 2024-06-13 토라 데이터 발견으로 의심되는 부분 수정함
            
            for (let i = 0; i < baseCnt; i++) {
                for (let ii = 0; ii < baseCnt; ii++) {
                    for (let iii = 0; iii < baseCnt; iii++) {
                        for (let iiii = 0; iiii < baseCnt; iiii++) {
                            setBonus(foundPet, base);
                            base.hp++;
                            if (base.hp == 3) {
                                base.hp = baseInit; // 2024-06-13 토라 데이터 발견으로 의심되는 부분 수정함
                            }
                        }
                        base.atk++;
                        if (base.atk == 3) {
                            base.atk = baseInit; // 2024-06-13 토라 데이터 발견으로 의심되는 부분 수정함
                        }
                    }
                    base.def++;
                    if (base.def == 3) {
                        base.def = baseInit; // 2024-06-13 토라 데이터 발견으로 의심되는 부분 수정함
                    }
                }
                base.agi++;
                if (base.agi == 3) {
                    base.agi = baseInit; // 2024-06-13 토라 데이터 발견으로 의심되는 부분 수정함
                }
            }
            
            /*
            if (foundPet.name == "만모링"   || 
                foundPet.name == "산타로스" || 
                foundPet.name == "링코링"   ||
                foundPet.name == "프로스비" ||
                foundPet.name == "산타링코") {
                alert("크리스마스 랭킹 이벤트에 포함되는 페트는 이벤트에 협조하는 차원에서 소수점만 공개합니다.");
            } else {
                print();
            }
            */
            print();
        }

        function setBonus(foundPet, base) {

            const bonus = {"hp":0,"atk":0,"def":0,"agi":0};

            for (let i = 0; i < 11; i++) {
                for (let ii = 0; ii < 11; ii++) {
                    for (let iii = 0; iii < 11; iii++) {
                        for (let iiii = 0; iiii < 11; iiii++) {
                            const sum = bonus.hp + bonus.atk + bonus.def + bonus.agi;
                            if (sum == 10) {
                                // 계산
                                addData(foundPet, base, bonus);
                            }
                            bonus.hp++;
                            if (bonus.hp == 11) {
                                bonus.hp = 0;
                            }
                        }
                        bonus.atk++;
                        if (bonus.atk == 11) {
                            bonus.atk = 0;
                        }
                    }
                    bonus.def++;
                    if (bonus.def == 11) {
                        bonus.def = 0;
                    }
                }
                bonus.agi++;
                if (bonus.agi == 11) {
                    bonus.agi = 0;
                }
            }
        }

        function addData(foundPet, base, bonus) {
            
            const hp  = preciseRound(foundPet.initnum * (foundPet.hp  + base.hp  + bonus.hp)  / 100);
            const atk = preciseRound(foundPet.initnum * (foundPet.atk + base.atk + bonus.atk) / 100);
            const def = preciseRound(foundPet.initnum * (foundPet.def + base.def + bonus.def) / 100);
            const agi = preciseRound(foundPet.initnum * (foundPet.agi + base.agi + bonus.agi) / 100);
            
            const stat = {"rank":0,"hp":0,"atk":0,"def":0,"agi":0,"baseHp":0,"baseAtk":0,"baseDef":0,"baseAgi":0,"bonusHp":0,"bonusAtk":0,"bonusDef":0,"bonusAgi":0,"poison":0};
            //stat.hp  = limitDecimalPlaces((hp * 4) + atk + def + agi, 2);
            //stat.atk = limitDecimalPlaces((hp * 0.1) + atk + (def * 0.1) + (agi * 0.05), 2);
            //stat.def = limitDecimalPlaces((hp * 0.1) + (atk * 0.1) + def + (agi * 0.05), 2);
            //stat.agi = limitDecimalPlaces(agi, 2);
            
            stat.hp  = preciseRound((hp * 4) + atk + def + agi);
            stat.atk = preciseRound((hp * 0.1) + atk + (def * 0.1) + (agi * 0.05));
            stat.def = preciseRound((hp * 0.1) + (atk * 0.1) + def + (agi * 0.05));
            stat.agi = agi;

            stat.poison = parseInt((foundPet.initnum * (foundPet.hp  + base.hp  + bonus.hp)),  10)
                        + parseInt((foundPet.initnum * (foundPet.atk + base.atk + bonus.atk)), 10)
                        + parseInt((foundPet.initnum * (foundPet.def + base.def + bonus.def)), 10)
                        + parseInt((foundPet.initnum * (foundPet.agi + base.agi + bonus.agi)), 10);
            stat.poison = preciseRound(( stat.poison / 100 - 20 ) / 4);
            if ( stat.poison < 1 ) stat.poison = 1;
            
            if (btnName == "calculate") {
                if (Math.floor(stat.hp)  === parseInt($("#hp").val(),  10) &&
                    Math.floor(stat.atk) === parseInt($("#atk").val(), 10) &&
                    Math.floor(stat.def) === parseInt($("#def").val(), 10) &&
                    Math.floor(stat.agi) === parseInt($("#agi").val(), 10)) {
                    stat.rank     = base.hp + base.atk + base.def + base.agi;
                    stat.baseHp   = base.hp;
                    stat.baseAtk  = base.atk;
                    stat.baseDef  = base.def;
                    stat.baseAgi  = base.agi;
                    stat.bonusHp  = bonus.hp;
                    stat.bonusAtk = bonus.atk;
                    stat.bonusDef = bonus.def;
                    stat.bonusAgi = bonus.agi;
                    result.push(stat);
                    /*
                    if (stat.rank == 8) {
                        console.log(foundPet.initnum + " " + foundPet.hp  + " " + base.hp  + " " + bonus.hp);
                        console.log(foundPet.initnum + " " + foundPet.atk + " " + base.atk + " " + bonus.atk);
                        console.log(foundPet.initnum + " " + foundPet.def + " " + base.def + " " + bonus.def);
                        console.log(foundPet.initnum + " " + foundPet.agi + " " + base.agi + " " + bonus.agi);
                    }
                    */
                }
            }
            else if (btnName == "search") {
                if (base.hp + base.atk + base.def + base.agi == 8) {
                    stat.rank     = base.hp + base.atk + base.def + base.agi;
                    stat.baseHp   = base.hp;
                    stat.baseAtk  = base.atk;
                    stat.baseDef  = base.def;
                    stat.baseAgi  = base.agi;
                    stat.bonusHp  = bonus.hp;
                    stat.bonusAtk = bonus.atk;
                    stat.bonusDef = bonus.def;
                    stat.bonusAgi = bonus.agi;
                    result.push(stat);
                }
            }
        }

        function print() {
            result.sort(function(a, b) {
                if (b['rank'] !== a['rank']) {
                    return b['rank'] - a['rank']; // rank를 기준으로 내림차순 정렬
                } else if (b['hp'] !== a['hp']) {
                    return b['hp'] - a['hp']; // hp를 기준으로 내림차순 정렬
                } else if (b['atk'] !== a['atk']) {
                    return b['atk'] - a['atk']; // atk를 기준으로 내림차순 정렬
                } else if (b['def'] !== a['def']) {
                    return b['def'] - a['def']; // def를 기준으로 내림차순 정렬
                } else {
                    return b['agi'] - a['agi']; // agi를 기준으로 내림차순 정렬
                }
            });

            for (let i = 0; i < result.length; i++) {
                $('#result tbody').append(''
                    + '<tr>'
                    + '<td>' + (i + 1) + '</td>'
                    + '<td class="' + (result[i].rank === 8 ? 'text-danger' : '') + '">' + result[i].rank + '</td>'
                    + '<td>' + limitDecimalPlaces(result[i].hp,  2) + '[' + result[i].baseHp  + '](' + result[i].bonusHp  + ')</td>'
                    + '<td>' + limitDecimalPlaces(result[i].atk, 2) + '[' + result[i].baseAtk + '](' + result[i].bonusAtk + ')</td>'
                    + '<td>' + limitDecimalPlaces(result[i].def, 2) + '[' + result[i].baseDef + '](' + result[i].bonusDef + ')</td>'
                    + '<td>' + limitDecimalPlaces(result[i].agi, 2) + '[' + result[i].baseAgi + '](' + result[i].bonusAgi + ')</td>'
                    //+ '<td>' + result[i].poison + '</td>'
                    + '</tr>'
                );

                if (i + 1 >= 300) {
                    break;
                }
            }

            // 결과 출력
            let message = '';
            if (btnName == "search") {
                
                const name = $("#name").val();
                message += `[${name}]의 8등급 분포는 다음과 같습니다!`;

                // 값을 카운트할 객체 생성
                var countMap = {};
                var totalCount = result.length;
                var statCounts = [];

                // 배열을 반복하면서 각 요소의 값을 카운트
                result.forEach(function(obj) {
                    var key = parseInt(obj.hp, 10) + ', ' + parseInt(obj.atk, 10) + ', ' + parseInt(obj.def, 10) + ', ' + parseInt(obj.agi, 10);
                    countMap[key] = (countMap[key] || 0) + 1;
                });

                // 결과를 문자열로 변환하여 출력
                for (var key in countMap) {
                    if (countMap.hasOwnProperty(key)) {
                        var count = countMap[key];
                        var percentage = (count / totalCount * 100).toFixed(2); // 백분율 계산 및 소수점 이하 두 자리까지만 표시
                        //message += key + ' ' + countMap[key] + '건 (' + percentage + '%)\n';
                        var arrStat = {};
                        arrStat['key'] = key;
                        arrStat['cnt'] = countMap[key];
                        arrStat['per'] = percentage;
                        statCounts.push(arrStat);
                    }
                }
                
                statCounts.sort(function (a, b) {
                    if (b['cnt'] !== a['cnt']) {
                        return b['cnt'] - a['cnt']; // 건수를 기준으로 내림차순 정렬
                    } else if (b['key'] !== a['key']) {
                        return b['key'] - a['key']; // 초기치를 기준으로 내림차순 정렬
                    } 
                });

                statCounts.forEach(function(obj) {
                    message += '\n' + obj['key'] + ' ' + obj['cnt'] + '건 (' + obj['per'] + '%)';
                });
            }
            else if (btnName == "calculate") {
                // 각 rank 값의 등장 횟수를 저장할 객체
                const rankCounts = {};

                // 배열 순회하면서 각 rank 값의 개수 체크
                for (let i = 0; i < result.length; i++) {
                    const rank = result[i].rank;
                    if (rankCounts[rank] === undefined) {
                        rankCounts[rank] = 1;
                    } else {
                        rankCounts[rank]++;
                    }
                }

                // 객체를 배열로 변환하고 rank에 대해 내림차순으로 정렬
                const ranks = Object.keys(rankCounts).sort((a, b) => b - a); // rank를 내림차순으로 정렬한 배열

                const name = $("#name").val();
                const hp = $("#hp").val();
                const atk = $("#atk").val();
                const def = $("#def").val();
                const agi = $("#agi").val();
                let   encounter = 0;
                if (result.length > 0) {
                    encounter = preciseRound(result.length / 178750 * 100).toFixed(4); // 모든 경우의 수 178750
                }

                //message += `[${name}][${hp}, ${atk}, ${def}, ${agi}] 출현율: ${encounter}%\n`
                message += `[${name}][${hp}, ${atk}, ${def}, ${agi}] 계산 완료!\n`
                const totalCount = Object.keys(rankCounts).reduce((acc, rank) => acc + rankCounts[rank], 0);
                for (const rank of ranks) {
                    const count = rankCounts[rank];
                    const percentage = (count / totalCount * 100).toFixed(2); // 소수점 둘째 자리까지 표시
                    message += `${rank} 등급: ${count} 건 (${percentage}%) \n`;
                }
            }
            
            alert(message);
            //$("#search").attr("disabled", false);
            //$("#calculate").attr("disabled", false);
        }

        function limitDecimalPlaces(number, places) {
            var power = Math.pow(10, places);
            return (Math.floor(number * power) / power).toFixed(places);
        }

        function preciseRound(num) {
            return Math.round(num * 1e12) / 1e12;
        }

        function poisonDamageRank() {
            for (var i = 0; i < pet.length; i++) {
                var poison8 = parseInt((pet[i].initnum * (pet[i].hp + 2 + 3)),  10)
                        + parseInt((pet[i].initnum * (pet[i].atk + 2 + 3)), 10)
                        + parseInt((pet[i].initnum * (pet[i].def + 2 + 2)), 10)
                        + parseInt((pet[i].initnum * (pet[i].agi + 2 + 2)), 10);
                poison8 = preciseRound(( poison8 / 100 - 20 ) / 4);
                if ( poison8 < 1 ) poison8 = 1;

                var poison7 = parseInt((pet[i].initnum * (pet[i].hp + 1 + 3)),  10)
                        + parseInt((pet[i].initnum * (pet[i].atk + 2 + 3)), 10)
                        + parseInt((pet[i].initnum * (pet[i].def + 2 + 2)), 10)
                        + parseInt((pet[i].initnum * (pet[i].agi + 2 + 2)), 10);
                poison7 = preciseRound(( poison7 / 100 - 20 ) / 4);
                if ( poison7 < 1 ) poison7 = 1;

                var poison6 = parseInt((pet[i].initnum * (pet[i].hp + 0 + 3)),  10)
                        + parseInt((pet[i].initnum * (pet[i].atk + 2 + 3)), 10)
                        + parseInt((pet[i].initnum * (pet[i].def + 2 + 2)), 10)
                        + parseInt((pet[i].initnum * (pet[i].agi + 2 + 2)), 10);
                poison6 = preciseRound(( poison6 / 100 - 20 ) / 4);
                if ( poison6 < 1 ) poison6 = 1;

                if ( poison8 >= 2 && poison8 % 1.0 < poison7 % 1.0) {
                    $("#poisonRank8").append("<footer>" + pet[i].name + ": " + poison8 + "</footer>");
                    continue;
                }

                if ( poison7 >= 2 && poison8 % 1.0 > poison7 % 1.0 && poison7 % 1.0 < poison6 % 1.0) {
                    $("#poisonRank7").append("<footer>" + pet[i].name + ": " + poison8 + "</footer>");
                }
            }
        }

        /*
        function getListName() {
            var text = "";
            pet.forEach(function(obj) {
                text += obj.name + ", ";
            });
            $("#listName").text(text);
        }
        */

        function checkUpdateExists() {
            const version = 20250124000;
            fetch(`https://leejoonwhan.github.io/stoneage/happy/version.json?v=${new Date().getTime()}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();  // 응답을 텍스트로 읽음
                })
                .then(text => {
                    try {
                        const data = JSON.parse(text);  // 텍스트를 JSON으로 파싱
                        log("ClientVer: " + version);
                        log("ServerVer: " + data.version);
                        if (version < data.version) {
                            let message = "업데이트가 확인되었습니다.\n페이지를 새로고침합니다.";
                            if (data.message != "") {
                                message += `\n\n업데이트 내용: \n${data.message}`;
                            }
                            
                            if (!alert(message)) {
                                location.reload();
                            }
                        }
                    } catch (error) {
                        console.error('Parsing error:', error);
                    }
                })
                .catch(error => {
                    console.error('Error fetching the JSON file:', error);
            });
        }

        function log(message) {
            const date = new Date();
            
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0'); // 0-based index
            const day = String(date.getDate()).padStart(2, '0');
            
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            const milliseconds = String(date.getMilliseconds()).padStart(3, '0');
            
            console.log(`[${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}] ${message}`);
        }

        function modalEvent() {
            // Close 버튼과 Footer 버튼을 숨김 (visibility: hidden)
            $('.modal-header .close, .modal-footer .btn').css('visibility', 'hidden');

            // 초기 카운트다운 시간 설정
            var timeLeft = 5;
            
            // 5초 카운트다운 표시 시작
            var countdownInterval = setInterval(function () {
                $('#countdown').text(timeLeft); // 시간 표시
                timeLeft--;

                // 시간이 0초가 되면 버튼을 표시하고 카운트다운 종료
                if (timeLeft < 0) {
                    $('#countdown').text("");
                    clearInterval(countdownInterval); // 카운트다운 종료
                    $('.modal-header .close, .modal-footer .btn').css('visibility', 'visible'); // 버튼 표시
                }
            }, 1000); // 1초마다 실행
            
        }

        // jQuery
        $(document).ready(function() {

            log("reload");

            // 페이지 로드 시 모달 자동 출력
            /*
            modalEvent();
            $('#myModal').modal({
                backdrop: 'static', // 외부 클릭 방지
                keyboard: false     // ESC 키 방지
            }).modal('show');       // 모달 표시
            */          
            // 페이지 로드 시 바로 실행
            poisonDamageRank();
            //getListName();

            $("#name").on("keydown", function(event) {
                if (event.key === 'Enter') {
                    $("#search").click();
                }
            });

            // 검색 버튼
            $("#search").on("click", function() {
                //$(this).attr("disabled", true);

                const foundPet = pet.find(p => p.name === $("#name").val());
                if (foundPet == undefined) {
                    alert("페트 정보를 찾을 수 없습니다.");
                    return;
                }
                btnName = "search";
                // foundPet을 깊은 복사하여 새로운 객체를 생성
                const copiedPet = JSON.parse(JSON.stringify(foundPet));
                setSRank(copiedPet);
                setBase(foundPet);
            });

            // 계산 버튼
            $("#calculate").on("click", function() {
                //$(this).attr("disabled", true);

                const foundPet = pet.find(p => p.name === $("#name").val());
                if (foundPet == undefined) {
                    alert("페트 정보를 찾을 수 없습니다.");
                    return;
                }
                btnName = "calculate";
                // foundPet을 깊은 복사하여 새로운 객체를 생성
                const copiedPet = JSON.parse(JSON.stringify(foundPet));
                setSRank(copiedPet);
                setBase(foundPet);
            });

            // 5분마다 업데이트 여부를 확인
            setInterval(checkUpdateExists, 1000 * 60 * 5);

            // 사용자가 버튼을 클릭하면 문서 상단으로 스크롤
            var btnTop = document.getElementById("btnTop");
            $("#btnTop").on("click", function() {
                document.body.scrollTop = 0;
                document.documentElement.scrollTop = 0;
            });
        });


/* ========= 상수 ========= */
const LS_TABLE = "novaPetTable_cache";
const TOTAL = 178750;
const ADMIN_PASS = "kokudas";

/* ========= 전역 ========= */
let GLOBAL_TABLE = {};
let ALL_NAMES = [];
let R8MAP = {}; // name -> {count, obs_100_rank8: [[hp,atk,def,agi],...]}

/* ========= 유틸 ========= */
function getJSONLS(key, fallback={}){ try{ return JSON.parse(localStorage.getItem(key)||JSON.stringify(fallback)); }catch{ return fallback; } }
function setJSONLS(key, obj){ localStorage.setItem(key, JSON.stringify(obj)); }
function fetchJSON(url){ return fetch(url+`?v=${Date.now()}`,{cache:"no-store"}).then(r=>{ if(!r.ok) throw 0; return r.json();}); }
function fmtPct(x){
  if(!Number.isFinite(x)) return "—%";
  if(x === 0) return "0.0000%";
  if(x < 0.001) return x.toFixed(6) + "%";
  return x.toFixed(4) + "%";
}

/* ========= 초성(문자 → 초성) 유틸 ========= */
const CHO_CODE = ['ㄱ','ㄲ','ㄴ','ㄷ','ㄸ','ㄹ','ㅁ','ㅂ','ㅃ','ㅅ','ㅆ','ㅇ','ㅈ','ㅉ','ㅊ','ㅋ','ㅌ','ㅍ','ㅎ'];
const CHO_SIMPLE = (c)=>({"ㄲ":"ㄱ","ㄸ":"ㄷ","ㅃ":"ㅂ","ㅆ":"ㅅ","ㅉ":"ㅈ"}[c]||c);
function getChosung(str){
  let out="";
  for(const ch of str){
    const code = ch.charCodeAt(0);
    if(code<0xAC00 || code>0xD7A3){ out+=ch; continue; }
    const idx = Math.floor((code - 0xAC00) / 588);
    out += CHO_SIMPLE(CHO_CODE[idx]);
  }
  return out;
}

/* ========= 원격 로드 ========= */
async function loadGlobalTable(){
  try{
    // 1차: raw.githubusercontent 경로
    const obj = await fetchJSON(REMOTE_PETS);
    if(typeof obj!=="object" || Array.isArray(obj)) throw 0;
    GLOBAL_TABLE = obj; setJSONLS(LS_TABLE, obj);
  }catch{
    try{
      // 2차: 같은 도메인의 /data/pets.json (깃허브 페이지/로컬 호환)
      const obj = await fetchJSON(LOCAL_PETS);
      if(typeof obj!=="object" || Array.isArray(obj)) throw 0;
      GLOBAL_TABLE = obj; setJSONLS(LS_TABLE, obj);
    }catch{
      // 3차: 로컬스토리지 캐시
      GLOBAL_TABLE = getJSONLS(LS_TABLE, {});
      console.warn("[pets] remote/local 모두 실패 → localStorage 캐시 사용");
    }
  }
  ALL_NAMES = Object.keys(GLOBAL_TABLE).sort((a,b)=>a.localeCompare(b,'ko'));
}
async function loadRank8Map(){
  for(const path of R8_JSON_CANDIDATES){
    try{
      const m = await fetchJSON(path);
      if (typeof m==="object" && !Array.isArray(m)){
        R8MAP = m;
        console.log("[Rank8] loaded:", path, "keys:", Object.keys(R8MAP).length);
        return;
      }
    }catch{ /* try next */ }
  }
  R8MAP = {};
  console.log("[Rank8] no file found; badge disabled");
}

/* ========= DOM ========= */
const chosungBar = document.getElementById('chosung');
const chosungTokens = document.getElementById('chosungTokens');
const petList = document.getElementById('petList');
const petSearch = document.getElementById('petSearch');

const s0hp = document.getElementById('s0_hp');
const s0atk= document.getElementById('s0_atk');
const s0def= document.getElementById('s0_def');
const s0agi= document.getElementById('s0_agi');

const sghp = document.getElementById('sg_hp');
const sgatk= document.getElementById('sg_atk');
const sgdef= document.getElementById('sg_def');
const sgagi= document.getElementById('sg_agi');

const obshp = document.getElementById('obs_hp');
const obsatk= document.getElementById('obs_atk');
const obsdef= document.getElementById('obs_def');
const obsagi= document.getElementById('obs_agi');

const kpiSuccess = document.getElementById('kpiSuccess');
const kpiAppear  = document.getElementById('kpiAppear');
const kpiTries   = document.getElementById('kpiTries');
const ringSuccess= document.getElementById('ringSuccess');
const ringAppear = document.getElementById('ringAppear');
const totMatches = document.getElementById('totMatches');
const rank8Matches = document.getElementById('rank8Matches');
const distBox = document.getElementById('dist');

const btnCalc = document.getElementById('btnCalc');
const btnReset= document.getElementById('btnReset');
const btnClear= document.getElementById('btnClear');

let currentChosung="";
let selectedName=null;
let selectedRow=null;
let selectedItemEl=null; // 선택 하이라이트 유지

// ===== 바디 레벨 툴팁 =====
const tipEl = document.createElement('div');
tipEl.className = 'floating-tip';
document.body.appendChild(tipEl);
let tipTimer = null;

function hideTip(){ tipEl.classList.remove('show'); }
function showTip(target){
  const text = target.getAttribute('data-tip');
  if(!text){ hideTip(); return; }
  const lines = String(text).split('\n');
  tipEl.textContent = '';
  lines.forEach((line,i)=>{
    tipEl.appendChild(document.createTextNode(line));
    if(i < lines.length-1) tipEl.appendChild(document.createElement('br'));
  });
  tipEl.classList.add('show');
  tipEl.style.left = '-9999px'; tipEl.style.top  = '-9999px'; tipEl.removeAttribute('data-pos');
  tipEl.getBoundingClientRect();
  const rect = target.getBoundingClientRect();
  const tw = tipEl.offsetWidth, th = tipEl.offsetHeight;
  const margin = 8;
  let pos = 'top';
  let left = rect.left + rect.width/2 - tw/2;
  left = Math.max(8, Math.min(left, window.innerWidth - tw - 8));
  let top = rect.top - th - margin;
  if(top < 6){ top = rect.bottom + margin; pos = 'bottom'; }
  tipEl.dataset.pos = pos;
  tipEl.style.left = `${Math.round(left)}px`;
  tipEl.style.top  = `${Math.round(top)}px`;
}
petList.addEventListener('mouseover', (e)=>{
  const t = e.target.closest('.tag.tip'); if(!t) return; showTip(t);
}, true);
petList.addEventListener('mouseout', (e)=>{
  const t = e.target.closest('.tag.tip'); if(!t) return; hideTip();
}, true);
petList.addEventListener('focusin', (e)=>{
  const t = e.target.closest('.tag.tip'); if(!t) return; showTip(t);
});
petList.addEventListener('focusout', (e)=>{
  const t = e.target.closest('.tag.tip'); if(!t) return; hideTip();
});
petList.addEventListener('touchstart', (e)=>{
  const t = e.target.closest('.tag.tip'); if(!t) return; e.stopPropagation(); showTip(t);
  clearTimeout(tipTimer); tipTimer = setTimeout(hideTip, 1800);
}, {passive:true});
window.addEventListener('scroll', hideTip, true);
window.addEventListener('resize', hideTip);

/* ========= 초성 키패드 ========= */
const CHO = ['ㄱ','ㄴ','ㄷ','ㄹ','ㅁ','ㅂ','ㅅ','ㅇ','ㅈ','ㅊ','ㅋ','ㅌ','ㅍ','ㅎ'];

function renderChosungTokens(){
  chosungTokens.innerHTML = "";
  for(const ch of currentChosung){
    const t = document.createElement('div');
    t.className = 'chip'; t.style.cursor = 'default'; t.textContent = ch;
    chosungTokens.appendChild(t);
  }
}
CHO.forEach(c=>{
  const chip=document.createElement('div');
  chip.className='chip'; chip.textContent=c;
  chip.addEventListener('click', ()=>{
    currentChosung += c;
    renderPetList();
    renderChosungTokens();
    Array.from(chosungBar.children).forEach(el=>el.classList.remove('on'));
    chip.classList.add('on');
  });
  chosungBar.appendChild(chip);
});
petSearch.addEventListener('input', renderPetList);

/* ========= 목록 ========= */
function renderPetList(){
  const kw = (petSearch.value||"").trim();
  const names = ALL_NAMES.length? ALL_NAMES : Object.keys(GLOBAL_TABLE);
  const list = names.filter(n=>{
    const a = kw? n.includes(kw): true;
    const b = currentChosung? getChosung(n).startsWith(currentChosung): true;
    return a && b;
  });

  petList.innerHTML="";
  if(list.length===0){
    const d=document.createElement('div'); d.className='item'; d.textContent='결과 없음';
    petList.appendChild(d);
    return;
  }

  list.forEach(n=>{
    const div=document.createElement('div'); div.className='item';

    const left=document.createElement('div'); left.textContent = n;
    const right=document.createElement('div'); right.className="tags";

    // 등록/미등록 배지
    const tag1=document.createElement('span');
    tag1.className='tag ' + (GLOBAL_TABLE[n]?'ok':'warn');
    tag1.textContent = GLOBAL_TABLE[n] ? '등록됨' : '미등록';
    right.appendChild(tag1);

    // 8등급 보장 배지
    const r8 = R8MAP[n];
    if (r8 && (Array.isArray(r8.obs_100_rank8) ? r8.obs_100_rank8.length : (r8.length||0))) {
      const sets = Array.isArray(r8.obs_100_rank8) ? r8.obs_100_rank8 : r8;
      const tag2 = document.createElement('span');
      tag2.className = 'tag rank8 tip';
      tag2.textContent = '100%';

      const maxShow = 12;
      const preview = sets.slice(0, maxShow).map(a=>`(${a[0]},${a[1]},${a[2]},${a[3]})`).join(' · ');
      const more = sets.length>maxShow ? ` 외 ${sets.length-maxShow}세트` : '';
      const tipText = `8등급 보장 초기치\n${preview}${more}`;
      tag2.setAttribute('data-tip', tipText);

      tag2.tabIndex = 0;
      const stop = (e)=>{ e.stopPropagation(); };
      tag2.addEventListener('click', stop);
      tag2.addEventListener('touchstart', stop, {passive:true});
      tag2.addEventListener('click', ()=>{
        tag2.classList.add('show');
        setTimeout(()=>tag2.classList.remove('show'), 1800);
      });

      right.appendChild(tag2);
    }

    div.appendChild(left);
    div.appendChild(right);
    div.addEventListener('click', ()=>{
      if(selectedItemEl) selectedItemEl.classList.remove('selected');
      div.classList.add('selected');
      selectedItemEl = div;
      selectPetName(n);
    });
    if (n === selectedName) { div.classList.add('selected'); selectedItemEl = div; }
    petList.appendChild(div);
  });

  renderChosungTokens();
}

/* ========= 펫 선택 ========= */
function selectPetName(n){
  selectedName=n;
  selectedRow=GLOBAL_TABLE[n]||null;

  if(selectedRow?.s0){
    s0hp.value=selectedRow.s0.hp??""; s0atk.value=selectedRow.s0.atk??"";
    s0def.value=selectedRow.s0.def??""; s0agi.value=selectedRow.s0.agi??"";
  }else{ s0hp.value=s0atk.value=s0def.value=s0agi.value=""; }

  if(selectedRow?.sg){
    sghp.value=selectedRow.sg.hp??""; sgatk.value=selectedRow.sg.atk??"";
    sgdef.value=selectedRow.sg.def??""; sgagi.value=selectedRow.sg.agi??"";
  }else{ sghp.value=sgatk.value=sgdef.value=sgagi.value=""; }

  if(selectedRow?.s0){
    obshp.value = Math.floor(selectedRow.s0.hp??NaN)||"";
    obsatk.value= Math.floor(selectedRow.s0.atk??NaN)||"";
    obsdef.value= Math.floor(selectedRow.s0.def??NaN)||"";
    obsagi.value= Math.floor(selectedRow.s0.agi??NaN)||"";
  }else{
    obshp.value=obsatk.value=obsdef.value=obsagi.value="";
  }
  showKpis(null);
}

/* ========= KPI 렌더 ========= */
function showKpis(res){
  if(!res){
    kpiSuccess.textContent = "—%";
    kpiAppear .textContent = "—%";
    kpiTries  .textContent = "—";
    ringSuccess.style.setProperty("--p","0deg");
    ringAppear .style.setProperty("--p","0deg");
    totMatches.textContent = "—";
    rank8Matches.textContent = "—";
    distBox.innerHTML = "";
    return;
  }
  const matches = res.matches|0;
  const rank8   = res.rank8|0;
  const appear = matches/TOTAL*100;
  const successPct = matches? (rank8/matches*100): 0;
  const tries = successPct>0? (100/successPct) : Infinity;

  kpiSuccess.textContent = fmtPct(successPct);
  kpiAppear .textContent = fmtPct(appear);
  kpiTries  .textContent = (isFinite(tries) ? tries.toFixed(2) : "—");

  ringSuccess.style.setProperty("--p", (360 * successPct / 100) + "deg");
  ringAppear .style.setProperty("--p", (360 * appear     / 100) + "deg");

  totMatches.textContent   = matches.toLocaleString();
  rank8Matches.textContent = rank8.toLocaleString();

  const entries = Object.entries(res.dist)
    .map(([r,c]) => ({r:parseInt(r,10), c}))
    .sort((a,b) => b.r - a.r || b.c - a.c);

  let html = `<table class="table"><thead><tr><th>등급(베이스합)</th><th>건수</th><th>비율</th></tr></thead><tbody>`;
  const total = matches || 1;
  entries.forEach(e=>{
    const pct = (e.c/total*100).toFixed(2);
    const cls = (e.r===8 ? "ok" : (e.r>=5 ? "warn" : ""));
    html += `<tr><td class="${cls}">${e.r}</td><td>${e.c.toLocaleString()}</td><td>${pct}%</td></tr>`;
  });
  html += `</tbody></table>`;
  distBox.innerHTML = html;
}

/* ========= 관측치 편의 ========= */
function enableWheelStep(el){
  el.addEventListener('wheel',(e)=>{
    if(document.activeElement!==el) return;
    e.preventDefault();
    const delta = e.deltaY<0? 1 : -1;
    const curr = parseInt(el.value||"0",10);
    el.value = String(curr + delta);
  }, {passive:false});
}
[obsatk,obshp,obsdef,obsagi].forEach(enableWheelStep);
document.addEventListener('click', (e)=>{
  const btn = e.target.closest('[data-delta][data-target]'); if(!btn) return;
  const id = btn.getAttribute('data-target'); const delta = parseInt(btn.getAttribute('data-delta'),10);
  const input=document.getElementById(id); if(!input) return;
  const curr=parseInt(input.value||"0",10); input.value=String(curr+delta);
});

/* ========= k/u 추정 ========= */
const ESET = [575, 555, 535, 515, 495, 475, 455, 435];

function solveUFromSG_JJYAL(SG, e){
  try{
    if(!SG || ![SG.hp,SG.atk,SG.def,SG.agi].every(Number.isFinite)) return null;
    Decimal.set({ precision:50, rounding: Decimal.ROUND_HALF_UP });

    const eD = new Decimal(e);
    const f  = eD.dividedBy(10000);
    const d  = new Decimal(SG.agi).times(10000).dividedBy(eD).minus(2.5);
    const dRound = d.round();
    const dPlus25 = dRound.plus(2.5);

    const rhs1 = new Decimal(SG.hp).minus( dPlus25.times(f) ).dividedBy(f);
    const rhs2 = new Decimal(SG.atk).minus( dPlus25.times(f).times(0.05) ).dividedBy(f);
    const rhs3 = new Decimal(SG.def).minus( dPlus25.times(f).times(0.05) ).dividedBy(f);

    let A = [
      [ new Decimal(4),   new Decimal(1),   new Decimal(1),   rhs1 ],
      [ new Decimal(0.1), new Decimal(1),   new Decimal(0.1), rhs2 ],
      [ new Decimal(0.1), new Decimal(0.1), new Decimal(1),   rhs3 ],
    ];
    for(let i=0;i<3;i++){
      let mr=i; let mv=A[i][i].abs();
      for(let j=i+1;j<3;j++){ const t=A[j][i].abs(); if(t.greaterThan(mv)){mr=j; mv=t;} }
      if(mr!==i){ const tmp=A[i]; A[i]=A[mr]; A[mr]=tmp; }
      const piv=A[i][i];
      for(let j=i;j<4;j++) A[i][j]=A[i][j].dividedBy(piv);
      for(let k=0;k<3;k++){
        if(k===i) continue;
        const fac=A[k][i];
        for(let j=i;j<4;j++) A[k][j]=A[k][j].minus( fac.times(A[i][j]) );
      }
    }
    const aPrime=A[0][3], bPrime=A[1][3], cPrime=A[2][3];

    const u_hp  = aPrime.minus(2.5).round();
    const u_atk = bPrime.minus(2.5).round();
    const u_def = cPrime.minus(2.5).round();
    const u_agi = dRound;

    const r2 = x => new Decimal(x).toDecimalPlaces(2);
    const hp_chk  = r2( f.times( u_hp.plus(2.5).times(4).plus(u_atk.plus(2.5)).plus(u_def.plus(2.5)).plus(u_agi.plus(2.5)) ) );
    const atk_chk = r2( f.times( u_hp.plus(2.5).times(0.1).plus(u_atk.plus(2.5)).plus(u_def.plus(2.5).times(0.1)).plus(u_agi.plus(2.5).times(0.05)) ) );
    const def_chk = r2( f.times( u_hp.plus(2.5).times(0.1).plus(u_atk.plus(2.5).times(0.1)).plus(u_def.plus(2.5)).plus(u_agi.plus(2.5).times(0.05)) ) );
    const agi_chk = r2( f.times( u_agi.plus(2.5) ) );

    const err = hp_chk.minus(r2(SG.hp)).abs()
               .plus(atk_chk.minus(r2(SG.atk)).abs())
               .plus(def_chk.minus(r2(SG.def)).abs())
               .plus(agi_chk.minus(r2(SG.agi)).abs());

    return { u:{hp:+u_hp, atk:+u_atk, def:+u_def, agi:+u_agi}, e, sg_err:+err };
  }catch(e){ return null; }
}

function s0_from_k_u_jjyal(k,u){
  const fac = k/100;
  const vhp  = (u.hp + 2.5) * fac;
  const vatk = (u.atk+ 2.5) * fac;
  const vdef = (u.def+ 2.5) * fac;
  const vagi = (u.agi+ 2.5) * fac;
  const s_hp = Math.floor(vhp*4 + vatk + vdef + vagi);
  const s_atk= Math.floor(vhp*0.1 + vatk + vdef*0.1 + vagi*0.05);
  const s_def= Math.floor(vhp*0.1 + vatk*0.1 + vdef + vagi*0.05);
  const s_agi= Math.floor(vagi);
  return [s_hp,s_atk,s_def,s_agi];
}
function fitKFromS0_JJYAL(S0int,u){
  let best=null;
  for(let k=10;k<=100;k++){
    const s = s0_from_k_u_jjyal(k,u);
    const l1 = Math.abs(s[0]-S0int[0]) + Math.abs(s[1]-S0int[1]) + Math.abs(s[2]-S0int[2]) + Math.abs(s[3]-S0int[3]);
    const ok = (l1===0);
    if(!best || (ok && !best.ok) || (!best.ok && l1<best.l1)) best={k,l1,ok};
    if(ok) break;
  }
  return best;
}
function inferKU_JJYAL(S0, SG){
  const S0int = S0.map(x=>Math.floor(x));
  let best=null;
  for(const e of ESET){
    const sol = solveUFromSG_JJYAL(SG, e);
    if(!sol) continue;
    const fit = fitKFromS0_JJYAL(S0int, sol.u);
    if(!fit) continue;
    const score = (fit.ok?0:1000) + fit.l1*10 + (sol.sg_err||0);
    const cand = {k:fit.k, u:sol.u, e, sg_err:sol.sg_err, s0_l1:fit.l1, s0_ok:fit.ok, score};
    if(!best || cand.score<best.score) best=cand;
  }
  return best;
}

/* ========= 엔진(합산 후 floor) ========= */
function enumerate_jjyal(pku, obs){
  const k = new Decimal(pku.k);
  const fac = k.dividedBy(100);
  const u = pku.u;

  let matches = 0, rank8 = 0;
  const dist = {};

  for(let ar=-2; ar<=2; ar++){
    for(let dr=-2; dr<=2; dr++){
      for(let gr=-2; gr<=2; gr++){
        for(let hr=-2; hr<=2; hr++){
          for(let ab=0; ab<=10; ab++){
            for(let db=0; db<=10; db++){
              for(let gb=0; gb<=10; gb++){
                const hb = 10 - ab - db - gb;
                if(hb < 0 || hb > 10) continue;

                const baseA = new Decimal(u.atk + ar + ab);
                const baseD = new Decimal(u.def + dr + db);
                const baseG = new Decimal(u.agi + gr + gb);
                const baseH = new Decimal(u.hp  + hr + hb);

                const iA = baseA.times(fac);
                const iD = baseD.times(fac);
                const iG = baseG.times(fac);
                const iH = baseH.times(fac);

                const calcAtk = iH.times(0.1).plus(iA).plus(iD.times(0.1)).plus(iG.times(0.05)).floor().toNumber();
                const calcDef = iH.times(0.1).plus(iA.times(0.1)).plus(iD).plus(iG.times(0.05)).floor().toNumber();
                const calcAgi = iG.floor().toNumber();
                const calcHp  = iH.times(4).plus(iA).plus(iD).plus(iG).floor().toNumber();

                if(calcAtk===obs[1] && calcDef===obs[2] && calcAgi===obs[3] && calcHp===obs[0]){
                  matches++;
                  const r = ar + dr + gr + hr;
                  dist[r] = (dist[r]||0) + 1;
                  if(r === 8) rank8++;
                }
              }
            }
          }
        }
      }
    }
  }
  return {matches, rank8, dist};
}

/* ========= 계산 ========= */
btnCalc.addEventListener('click', async ()=>{
  if(!selectedName){ alert("펫을 먼저 선택하세요."); return; }
  const obs=[obshp,obsatk,obsdef,obsagi].map(e=>parseInt(e.value,10));
  if(obs.some(v=>!Number.isFinite(v))){ alert("관측 표기치(정수)를 모두 입력하세요."); return; }

  const row=GLOBAL_TABLE[selectedName]||{};
  if(!row?.s0 || !row?.sg){ alert("이 펫은 S0/SG가 등록되어 있지 않습니다."); return; }

  let k=row.k, u=row.u;
  if(!(Number.isFinite(k) && u && [u.hp,u.atk,u.def,u.agi].every(Number.isFinite))){
    const S0=[row.s0.hp, row.s0.atk, row.s0.def, row.s0.agi];
    const SG=row.sg;
    const fit = inferKU_JJYAL(S0, SG);
    if(!fit){ alert("k/u 추정 실패: S0/SG를 확인하세요."); return; }
    k=fit.k; u=fit.u;
  }
  const res = enumerate_jjyal({k,u}, obs);
  showKpis(res);
});

btnReset.addEventListener('click', ()=>{
  selectedName=null; selectedRow=null;
  petSearch.value=""; currentChosung="";
  Array.from(chosungBar.children).forEach(el=>el.classList.remove('on'));
  petList.querySelectorAll('.item.selected').forEach(el=>el.classList.remove('selected'));
  selectedItemEl = null;
  renderPetList();
  [s0hp,s0atk,s0def,s0agi,sghp,sgatk,sgdef,sgagi,obshp,obsatk,obsdef,obsagi].forEach(i=>i.value="");
  showKpis(null);
});
btnClear.addEventListener('click', ()=>{
  petSearch.value=""; currentChosung="";
  Array.from(chosungBar.children).forEach(el=>el.classList.remove('on'));
  petList.querySelectorAll('.item.selected').forEach(el=>el.classList.remove('selected'));
  selectedItemEl = null;
  renderPetList();
});

/* ========= 부팅 ========= */
(async function init(){
  console.log("[init] start");
  await loadGlobalTable();
  await loadRank8Map();
  console.log("[init] pets:", Object.keys(GLOBAL_TABLE).length, "rank8 keys:", Object.keys(R8MAP).length);
  renderPetList();
})();
</script>
</body>
</html>
